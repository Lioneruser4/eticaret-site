<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cəngavər Döyüşü PRO</title>
    <style>
        :root { --elixir-color: #f062ff; --ui-bg: rgba(20, 20, 20, 0.9); }
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Trebuchet MS', sans-serif; user-select: none; }
        
        /* Oyun Sahəsi */
        #game-wrapper { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; }
        canvas { background: #355e3b; box-shadow: inset 0 0 100px rgba(0,0,0,0.5); cursor: crosshair; }

        /* UI Elementləri */
        #ui-top { position: absolute; top: 10px; width: 90%; display: flex; justify-content: space-between; z-index: 100; pointer-events: none; }
        .stat-box { background: var(--ui-bg); padding: 5px 15px; border-radius: 20px; border: 2px solid #ffd700; color: white; font-weight: bold; }

        #ui-bottom { position: absolute; bottom: 0; width: 100%; height: 160px; background: linear-gradient(to top, #1a1a1a, transparent); display: flex; flex-direction: column; align-items: center; z-index: 100; }
        
        /* Eliksir Barı */
        .elixir-container { width: 80%; height: 15px; background: #333; border-radius: 10px; margin-bottom: 10px; border: 2px solid #555; position: relative; }
        #elixir-progress { height: 100%; width: 0%; background: var(--elixir-color); box-shadow: 0 0 10px var(--elixir-color); transition: width 0.3s; }
        #elixir-text { position: absolute; width: 100%; text-align: center; color: white; font-size: 12px; font-weight: bold; top: -2px; }

        /* Kartlar */
        .hand { display: flex; gap: 10px; padding: 10px; }
        .card { width: 70px; height: 95px; background: #444; border-radius: 8px; border: 3px solid #777; position: relative; transition: 0.2s; overflow: hidden; }
        .card.active { border-color: #ffd700; transform: translateY(-10px); cursor: pointer; }
        .card.selected { border-color: #00ff00; box-shadow: 0 0 15px #00ff00; }
        .card-cost { position: absolute; top: -2px; right: -2px; background: var(--elixir-color); color: white; padding: 2px 6px; border-radius: 0 0 0 8px; font-size: 12px; }
        .card-name { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.7); color: white; font-size: 10px; text-align: center; padding: 2px 0; }
        
        /* Animasiyalar */
        @keyframes damage { 0% { filter: brightness(1); } 50% { filter: brightness(3) sepia(1); } 100% { filter: brightness(1); } }
        .hit { animation: damage 0.2s; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="ui-top">
        <div class="stat-box">Düşmən: <span id="bot-score">3</span></div>
        <div class="stat-box">Sən: <span id="player-score">3</span></div>
    </div>

    <canvas id="arena"></canvas>

    <div id="ui-bottom">
        <div class="elixir-container">
            <div id="elixir-progress"></div>
            <div id="elixir-text">ELİKSİR: 0</div>
        </div>
        <div class="hand">
            <div class="card" data-id="knight" data-cost="3">
                <div class="card-cost">3</div>
                <div class="card-name">CƏNGAVƏR</div>
            </div>
            <div class="card" data-id="archer" data-cost="2">
                <div class="card-cost">2</div>
                <div class="card-name">OXÇU</div>
            </div>
            <div class="card" data-id="giant" data-cost="5">
                <div class="card-cost">5</div>
                <div class="card-name">DİV</div>
            </div>
            <div class="card" data-id="spell" data-cost="4">
                <div class="card-cost">4</div>
                <div class="card-name">OD TOPU</div>
            </div>
        </div>
    </div>
</div>

<script>
/** * PRO STRATEGİYA MÜHƏRRİKİ v2.0
 * Bütün məntiq OOP (Obyekt Yönümlü Proqramlaşdırma) ilə qurulub.
 */

const CONFIG = {
    LANE_L: 0.25,
    LANE_R: 0.75,
    START_ELIXIR: 5,
    MAX_ELIXIR: 10,
    ELIXIR_SPEED: 0.015, // Saniyədə artım
    TOWER_HP: 1500,
    KING_HP: 3000
};

class Game {
    constructor() {
        this.canvas = document.getElementById('arena');
        this.ctx = this.canvas.getContext('2d');
        this.resize();
        
        this.entities = [];
        this.particles = [];
        this.elixir = CONFIG.START_ELIXIR;
        this.selectedCard = null;
        this.isGameOver = false;

        this.initEventListeners();
        this.setupMap();
        this.spawnInitialTowers();
        this.loop();
    }

    resize() {
        this.canvas.width = window.innerWidth > 500 ? 400 : window.innerWidth;
        this.canvas.height = window.innerHeight;
        this.scale = this.canvas.width / 400;
    }

    setupMap() {
        // Çay və körpü koordinatları
        this.riverY = this.canvas.height / 2;
    }

    spawnInitialTowers() {
        const createTower = (x, y, hp, team, type) => {
            this.entities.push(new Tower(x * this.canvas.width, y * this.canvas.height, hp, team, type));
        };

        // Player towers (Göy)
        createTower(0.2, 0.8, CONFIG.TOWER_HP, 'player', 'side');
        createTower(0.8, 0.8, CONFIG.TOWER_HP, 'player', 'side');
        createTower(0.5, 0.9, CONFIG.KING_HP, 'player', 'king');

        // Bot towers (Qırmızı)
        createTower(0.2, 0.2, CONFIG.TOWER_HP, 'bot', 'side');
        createTower(0.8, 0.2, CONFIG.TOWER_HP, 'bot', 'side');
        createTower(0.5, 0.1, CONFIG.KING_HP, 'bot', 'king');
    }

    initEventListeners() {
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('click', (e) => {
                const cost = parseInt(card.dataset.cost);
                if (this.elixir >= cost) {
                    this.selectedCard = { id: card.dataset.id, cost: cost };
                    document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                    card.classList.add('selected');
                }
            });
        });

        this.canvas.addEventListener('mousedown', (e) => this.handleInput(e.clientX, e.clientY));
        this.canvas.addEventListener('touchstart', (e) => this.handleInput(e.touches[0].clientX, e.touches[0].clientY));
    }

    handleInput(rawX, rawY) {
        if (!this.selectedCard) return;
        
        const rect = this.canvas.getBoundingClientRect();
        const x = rawX - rect.left;
        const y = rawY - rect.top;

        // Yerləşdirmə qaydası (Məsələn: Sən ancaq öz tərəfinə qoya bilərsən)
        if (y < this.riverY && this.selectedCard.id !== 'spell') return;

        this.spawnUnit(x, y, 'player', this.selectedCard.id);
        this.elixir -= this.selectedCard.cost;
        this.selectedCard = null;
        document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
    }

    spawnUnit(x, y, team, type) {
        let unit;
        switch(type) {
            case 'knight': unit = new Knight(x, y, team); break;
            case 'archer': unit = new Archer(x, y, team); break;
            case 'giant':  unit = new Giant(x, y, team); break;
            case 'spell':  this.triggerSpell(x, y, team); return;
        }
        if(unit) this.entities.push(unit);
    }

    triggerSpell(x, y, team) {
        this.particles.push(new Explosion(x, y));
        this.entities.forEach(ent => {
            const dist = Math.hypot(ent.x - x, ent.y - y);
            if (dist < 80 && ent.team !== team) ent.takeDamage(400);
        });
    }

    update() {
        if (this.isGameOver) return;

        this.elixir = Math.min(CONFIG.MAX_ELIXIR, this.elixir + CONFIG.ELIXIR_SPEED);
        this.updateUI();

        // Entity logic
        this.entities.forEach(ent => ent.update(this.entities, this.particles));
        this.entities = this.entities.filter(ent => ent.hp > 0);
        
        // Particle logic
        this.particles.forEach(p => p.update());
        this.particles = this.particles.filter(p => !p.dead);

        // Simple AI
        if (Math.random() < 0.01) {
            const types = ['knight', 'archer', 'giant'];
            const type = types[Math.floor(Math.random() * types.length)];
            this.spawnUnit(Math.random() * this.canvas.width, 100, 'bot', type);
        }
    }

    updateUI() {
        document.getElementById('elixir-progress').style.width = (this.elixir / CONFIG.MAX_ELIXIR * 100) + '%';
        document.getElementById('elixir-text').innerText = `ELİKSİR: ${Math.floor(this.elixir)}`;
        
        document.querySelectorAll('.card').forEach(card => {
            if (parseInt(card.dataset.cost) <= this.elixir) card.classList.add('active');
            else card.classList.remove('active');
        });
    }

    draw() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        this.drawMap();
        this.entities.sort((a,b) => a.y - b.y).forEach(ent => ent.draw(this.ctx));
        this.particles.forEach(p => p.draw(this.ctx));
    }

    drawMap() {
        const ctx = this.ctx;
        // Ot
        ctx.fillStyle = '#457b4d';
        ctx.fillRect(0,0, this.canvas.width, this.canvas.height);
        
        // Çay
        ctx.fillStyle = '#4a90e2';
        ctx.fillRect(0, this.riverY - 20, this.canvas.width, 40);

        // Körpülər
        ctx.fillStyle = '#795548';
        ctx.fillRect(this.canvas.width * 0.2 - 25, this.riverY - 25, 50, 50);
        ctx.fillRect(this.canvas.width * 0.8 - 25, this.riverY - 25, 50, 50);
    }

    loop() {
        this.update();
        this.draw();
        requestAnimationFrame(() => this.loop());
    }
}

/** * ENTITY CLASSES (Oyun obyektləri)
 */

class Entity {
    constructor(x, y, hp, team) {
        this.x = x; this.y = y; this.hp = hp; this.maxHp = hp;
        this.team = team;
        this.size = 20;
        this.attackTimer = 0;
    }

    takeDamage(amt) {
        this.hp -= amt;
        this.isHit = true;
        setTimeout(() => this.isHit = false, 150);
    }

    drawHP(ctx) {
        const w = 30;
        ctx.fillStyle = 'black';
        ctx.fillRect(this.x - w/2, this.y - this.size - 10, w, 5);
        ctx.fillStyle = this.team === 'player' ? '#00ff00' : '#ff0000';
        ctx.fillRect(this.x - w/2, this.y - this.size - 10, w * (this.hp/this.maxHp), 5);
    }
}

class Tower extends Entity {
    constructor(x, y, hp, team, type) {
        super(x, y, hp, team);
        this.type = type;
        this.size = type === 'king' ? 40 : 30;
        this.range = 150;
    }

    update(entities) {
        if (this.attackTimer > 0) this.attackTimer--;
        else {
            const enemy = entities.find(e => e.team !== this.team && Math.hypot(e.x - this.x, e.y - this.y) < this.range);
            if (enemy) {
                enemy.takeDamage(50);
                this.attackTimer = 60;
            }
        }
    }

    draw(ctx) {
        ctx.save();
        if (this.isHit) ctx.filter = 'brightness(2)';
        ctx.fillStyle = this.team === 'player' ? '#2c3e50' : '#c0392b';
        ctx.beginPath();
        ctx.roundRect(this.x - this.size, this.y - this.size, this.size*2, this.size*2, 5);
        ctx.fill();
        ctx.strokeStyle = 'gold';
        ctx.stroke();
        ctx.restore();
        this.drawHP(ctx);
    }
}

class Unit extends Entity {
    constructor(x, y, hp, team, speed, range, damage) {
        super(x, y, hp, team);
        this.speed = speed;
        this.range = range;
        this.damage = damage;
        this.target = null;
    }

    update(entities, particles) {
        if (this.attackTimer > 0) this.attackTimer--;

        this.target = this.findBestTarget(entities);
        if (this.target) {
            const dist = Math.hypot(this.target.x - this.x, this.target.y - this.y);
            if (dist < this.range) {
                if (this.attackTimer <= 0) {
                    this.target.takeDamage(this.damage);
                    this.attackTimer = 50;
                    particles.push(new HitSpark(this.target.x, this.target.y));
                }
            } else {
                const angle = Math.atan2(this.target.y - this.y, this.target.x - this.x);
                this.x += Math.cos(angle) * this.speed;
                this.y += Math.sin(angle) * this.speed;
            }
        }
    }

    findBestTarget(entities) {
        let nearest = null;
        let minDist = Infinity;
        entities.forEach(e => {
            if (e.team !== this.team) {
                const d = Math.hypot(e.x - this.x, e.y - this.y);
                if (d < minDist) { minDist = d; nearest = e; }
            }
        });
        return nearest;
    }
}

class Knight extends Unit {
    constructor(x, y, team) { super(x, y, 500, team, 1.2, 30, 45); }
    draw(ctx) {
        ctx.fillStyle = this.team === 'player' ? '#3498db' : '#e74c3c';
        ctx.beginPath(); ctx.arc(this.x, this.y, 15, 0, Math.PI*2); ctx.fill();
        this.drawHP(ctx);
    }
}

class Giant extends Unit {
    constructor(x, y, team) { super(x, y, 2000, team, 0.6, 40, 80); }
    draw(ctx) {
        ctx.fillStyle = '#d35400';
        ctx.beginPath(); ctx.arc(this.x, this.y, 25, 0, Math.PI*2); ctx.fill();
        this.drawHP(ctx);
    }
}

class Archer extends Unit {
    constructor(x, y, team) { super(x, y, 250, team, 1.5, 120, 25); }
    draw(ctx) {
        ctx.fillStyle = '#9b59b6';
        ctx.beginPath(); ctx.moveTo(this.x, this.y-15); ctx.lineTo(this.x+12, this.y+10); ctx.lineTo(this.x-12, this.y+10); ctx.fill();
        this.drawHP(ctx);
    }
}

/**
 * EFFEKTLƏR (Particles)
 */
class Explosion {
    constructor(x,y) { this.x=x; this.y=y; this.r=10; this.dead=false; }
    update() { this.r += 5; if(this.r > 80) this.dead=true; }
    draw(ctx) {
        ctx.strokeStyle = `rgba(255, 100, 0, ${1 - this.r/80})`;
        ctx.lineWidth = 5;
        ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2); ctx.stroke();
    }
}

class HitSpark {
    constructor(x,y) { this.x=x; this.y=y; this.life=10; this.dead=false; }
    update() { this.life--; if(this.life<=0) this.dead=true; }
    draw(ctx) {
        ctx.fillStyle = 'white';
        ctx.fillRect(this.x-5, this.y-5, 10, 10);
    }
}

// Oyunu Başlat
window.onload = () => new Game();

</script>
</body>
</html>
