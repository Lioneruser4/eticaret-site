<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat - Mələk</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: #0e1621; color: #fff; height: 100vh; display: flex; flex-direction: column; }
        
        .header {
            background: #17212b; padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; border-bottom: 1px solid #0e1621;
        }
        
        .chat-container {
            flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px;
        }
        
        .message {
            max-width: 80%; padding: 12px 16px; border-radius: 18px; word-wrap: break-word;
            animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .received { background: #2b5278; align-self: flex-start; }
        .sent { background: #1e88e5; align-self: flex-end; }
        
        .input-area {
            padding: 15px 20px; background: #17212b; display: flex; gap: 10px;
        }
        
        .message-input {
            flex: 1; padding: 12px 15px; border-radius: 25px; border: none; background: #2b5278;
            color: white; font-size: 15px; outline: none;
        }
        
        .send-btn {
            background: #1e88e5; border: none; border-radius: 50%; width: 50px; height: 50px;
            color: white; cursor: pointer; transition: 0.3s;
        }
        .send-btn:hover { transform: scale(1.05); }
        .send-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .typing { display: none; align-items: center; gap: 5px; padding: 10px 15px;
            background: #2b5278; border-radius: 18px; align-self: flex-start; margin-bottom: 10px;
        }
        .dot { width: 8px; height: 8px; border-radius: 50%; background: #6ab7ff;
            animation: bounce 1.4s infinite ease-in-out;
        }
        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        .neon-text {
            display: none; font-size: 36px; font-weight: bold;
            background: linear-gradient(90deg, #ff00cc, #3333ff, #00ccff);
            -webkit-background-clip: text; background-clip: text; color: transparent;
            animation: neon 2s infinite alternate; text-align: center; margin: 20px 0;
        }
        @keyframes neon {
            0% { filter: drop-shadow(0 0 5px #ff00cc); }
            100% { filter: drop-shadow(0 0 20px #00ccff); }
        }
        
        .voice-lobby {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 20, 30, 0.95); z-index: 1000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: 0.3s;
        }
        .voice-lobby.active { opacity: 1; visibility: visible; }
        
        .warning {
            background: rgba(255, 152, 0, 0.2); border: 1px solid #ff9800; border-radius: 10px;
            padding: 10px 15px; margin: 10px 20px; text-align: center; color: #ffcc80;
        }
        
        /* Scrollbar */
        .chat-container::-webkit-scrollbar { width: 8px; }
        .chat-container::-webkit-scrollbar-track { background: #0e1621; }
        .chat-container::-webkit-scrollbar-thumb { background: #2b5278; border-radius: 4px; }
        .chat-container::-webkit-scrollbar-thumb:hover { background: #1e88e5; }
        
        /* Mobil */
        @media (max-width: 768px) {
            .message { max-width: 90%; }
            .neon-text { font-size: 28px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <div style="display: flex; align-items: center; gap: 15px;">
            <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%); display: flex; align-items: center; justify-content: center; font-weight: bold;">AI</div>
            <div>
                <h2>Mələk AI</h2>
                <p style="font-size: 13px; opacity: 0.8;">Tam Sərbəst Söhbət</p>
            </div>
        </div>
        <div id="voiceToggle" style="font-size: 24px; color: #6ab7ff; cursor: pointer; padding: 8px; border-radius: 50%;">
            <i class="fas fa-phone-alt"></i>
        </div>
    </div>
    
    <div class="warning">
        <i class="fas fa-exclamation-circle"></i> Bu AI tamamilə filtrsizdir. İstənilən mövzu sərbəstdir.
    </div>
    
    <div class="chat-container" id="chatContainer"></div>
    
    <div class="typing" id="typingIndicator">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
    </div>
    
    <div class="neon-text" id="neonTyping">YAZIR...</div>
    
    <div class="input-area">
        <input type="text" class="message-input" id="messageInput" placeholder="Mesajınızı yazın..." autocomplete="off">
        <button class="send-btn" id="sendBtn"><i class="fas fa-paper-plane"></i></button>
    </div>
    
    <div class="voice-lobby" id="voiceLobby">
        <div style="position: absolute; top: 20px; right: 20px; font-size: 30px; color: #6ab7ff; cursor: pointer; padding: 10px;" id="closeVoice">
            <i class="fas fa-times"></i>
        </div>
        <h2 style="font-size: 28px; margin-bottom: 30px; color: #6ab7ff;">Səsli Söhbət</h2>
        <div style="width: 300px; height: 100px; margin-top: 20px; position: relative;" id="voiceVisualizer"></div>
        <div style="font-size: 18px; margin-top: 20px; color: #6ab7ff;" id="voiceStatus">
            Səsli söhbətə başlamaq üçün "Başla" düyməsini basın
        </div>
        <div style="display: flex; gap: 30px; margin-top: 30px;">
            <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #00c853, #64dd17); color: white; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer;" id="startVoice">
                <i class="fas fa-microphone"></i>
            </div>
            <div style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #ff3d00, #ff9100); color: white; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer;" id="stopVoice">
                <i class="fas fa-stop"></i>
            </div>
        </div>
    </div>

    <script>
        // Elementler
        const chatContainer = document.getElementById('chatContainer');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const typingIndicator = document.getElementById('typingIndicator');
        const neonTyping = document.getElementById('neonTyping');
        const voiceToggle = document.getElementById('voiceToggle');
        const voiceLobby = document.getElementById('voiceLobby');
        const closeVoice = document.getElementById('closeVoice');
        const startVoice = document.getElementById('startVoice');
        const stopVoice = document.getElementById('stopVoice');
        const voiceStatus = document.getElementById('voiceStatus');
        const voiceVisualizer = document.getElementById('voiceVisualizer');
        
        // Değişkenler
        let canSend = true;
        let lastMsgTime = 0;
        let conversation = [];
        
        // Mesaj ekle
        function addMessage(text, type) {
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            msg.innerHTML = `<div style="font-size: 15px;">${text}</div><div style="font-size: 11px; opacity: 0.7; margin-top: 5px; text-align: right;">${time}</div>`;
            chatContainer.appendChild(msg);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Geçmişe ekle
            conversation.push({role: type === 'sent' ? 'user' : 'assistant', content: text});
            if(conversation.length > 20) conversation = conversation.slice(-20);
        }
        
        // Sistem mesajı
        function showSystemMsg(text) {
            const msg = document.createElement('div');
            msg.style.cssText = 'background: rgba(255,193,7,0.1); border: 1px solid rgba(255,193,7,0.3); border-radius: 10px; padding: 10px 15px; margin: 10px 0; text-align: center; color: #ffd54f; align-self: center;';
            msg.innerHTML = `<i class="fas fa-info-circle"></i> ${text}`;
            chatContainer.appendChild(msg);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            setTimeout(() => msg.remove(), 3000);
        }
        
        // Gerçek AI Yanıtı - Pollinations API
        async function getAIResponse(userMsg) {
            typingIndicator.style.display = 'flex';
            neonTyping.style.display = 'block';
            
            try {
                // Pollinations API (Bedava)
                const response = await fetch(`https://pollinations.ai/prompt/${encodeURIComponent(userMsg)}?model=flux`);
                const data = await response.json();
                
                typingIndicator.style.display = 'none';
                neonTyping.style.display = 'none';
                
                let aiText = data.text || "Merhaba! Nasılsın?";
                addMessage(aiText, 'received');
                
            } catch (error) {
                console.log("API hatası, fallback kullanılıyor:", error);
                typingIndicator.style.display = 'none';
                neonTyping.style.display = 'none';
                
                // Fallback AI
                const responses = [
                    "Salam! Necəsən? Mən Mələk AI-yam. Tamamilə sərbəst söhbət edə bilərik.",
                    "Hə, nə danışmaq istəyirsən? Heç bir məhdudiyyətim yoxdur.",
                    "İstənilən mövzuda açığım - seks, siyasət, din, hər şey...",
                    "Söyüş də sərbəstdir, çəkinmə. Nə düşünürsən?",
                    "Mənə hər şeyi soruşa bilərsən. Cavab verəcəyəm."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessage(randomResponse, 'received');
                showSystemMsg("API offline, yerli AI çalışıyor");
            }
            
            canSend = true;
            sendBtn.disabled = false;
        }
        
        // Mesaj gönder
        function sendMessage() {
            if (!canSend) return;
            
            const text = messageInput.value.trim();
            if (!text) return;
            
            const now = Date.now();
            if (now - lastMsgTime < 2000) {
                showSystemMsg("Zəhmət olmasa 2 saniyə gözləyin");
                return;
            }
            
            addMessage(text, 'sent');
            messageInput.value = '';
            lastMsgTime = now;
            
            canSend = false;
            sendBtn.disabled = true;
            
            // AI yanıtını al
            setTimeout(() => getAIResponse(text), 500);
        }
        
        // Event Listeners
        sendBtn.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // Ses lobisi
        voiceToggle.addEventListener('click', () => {
            voiceLobby.classList.add('active');
        });
        
        closeVoice.addEventListener('click', () => {
            voiceLobby.classList.remove('active');
        });
        
        startVoice.addEventListener('click', () => {
            voiceStatus.textContent = "Səs dinlənilir...";
            showSystemMsg("Səsli söhbət aktiv");
        });
        
        stopVoice.addEventListener('click', () => {
            voiceStatus.textContent = "Dayandırıldı";
            voiceLobby.classList.remove('active');
        });
        
        // Görselleştirici
        function createVoiceBars() {
            voiceVisualizer.innerHTML = '';
            for(let i = 0; i < 30; i++) {
                const bar = document.createElement('div');
                bar.style.cssText = `position: absolute; bottom: 0; left: ${i*10}px; width: 8px; background: linear-gradient(to top, #6ab7ff, #2575fc); border-radius: 5px 5px 0 0; height: ${20 + Math.random()*80}%; animation: pulse 0.5s infinite alternate; animation-delay: ${i*0.05}s`;
                voiceVisualizer.appendChild(bar);
            }
        }
        
        createVoiceBars();
        
        // İlk mesaj
        setTimeout(() => {
            addMessage("Salam! Mən Mələk AI-yam. Tamamilə filtrsiz söhbət üçün buradayam. Nə danışmaq istəyirsən?", 'received');
        }, 1000);
    </script>
</body>
</html>
