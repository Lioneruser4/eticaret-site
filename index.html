<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XSCAN ‚Äì Universal Kod Oxuyucu</title>

<!-- QR + Barkod + VIN oxuma kitabxanasƒ± -->
<script src="https://unpkg.com/html5-qrcode"></script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #0d0d0d;
        color: white;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    header {
        padding: 20px;
        font-size: 26px;
        font-weight: bold;
        animation: fadeIn 1s ease;
    }

    .container {
        padding: 20px;
        animation: fadeInUp 1s ease;
    }

    #reader {
        width: 320px;
        margin: auto;
        display: none;
    }

    .info-box {
        background: #1a1a1a;
        padding: 20px;
        border-radius: 12px;
        margin-top: 20px;
        display: none;
        animation: fadeIn 0.5s ease;
    }

    .product-img {
        width: 150px;
        border-radius: 10px;
        margin-top: 10px;
    }

    .button {
        background: #ff6b00;
        color: white;
        padding: 12px 20px;
        margin-top: 20px;
        border:none;
        border-radius: 10px;
        font-size: 18px;
        cursor: pointer;
        animation: fadeIn 1s ease;
    }

    .input-box {
        margin-top: 20px;
    }

    input {
        width: 80%;
        padding: 12px;
        border-radius: 10px;
        border: none;
        font-size: 16px;
        margin-bottom: 10px;
    }

    @keyframes fadeIn {
        from {opacity: 0;} to {opacity: 1;}
    }
    @keyframes fadeInUp {
        from {opacity: 0; transform: translateY(20px);} 
        to {opacity: 1; transform: translateY(0);}
    }
</style>
</head>
<body>

<header>XSCAN ‚Äì Universal Kod Oxuyucu</header>

<div class="container" id="startScreen">
    XSCAN b√ºt√ºn <b>barkod, QR, VIN</b> kodlarƒ±nƒ± oxuyur v…ô m…ôhsulun <br>
    <b>≈ü…ôkli, adƒ±, t…ôsviri, istehsal√ßƒ±</b> kimi m…ôlumatlarƒ± g√∂st…ôrir. <br><br>

    <button class="button" onclick="startScanner()">Oxutmaƒüa Ba≈üla</button>

    <div class="input-box">
        <input type="text" id="manualInput" placeholder="VIN v…ô ya Barkod daxil et">
        <button class="button" onclick="manualLookup()">Axtar</button>
    </div>
</div>

<div id="reader"></div>

<div class="info-box" id="resultBox"></div>
<button class="button" id="backBtn" style="display:none;" onclick="goBack()">Geri</button>

<script>
let scanner;

// Kamera a√ß
function startScanner() {
    document.getElementById("startScreen").style.display = "none";
    document.getElementById("reader").style.display = "block";

    scanner = new Html5Qrcode("reader");

    scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        code => {
            scanner.stop();
            document.getElementById("reader").style.display = "none";
            showResult(code);
        }
    );
}

// ∆èll…ô daxil etm…ô
function manualLookup() {
    const code = document.getElementById("manualInput").value.trim();
    if (!code) return alert("Kod daxil et");
    showResult(code);
}

// N…ôtic…ô g√∂st…ôr
function showResult(code) {
    document.getElementById("backBtn").style.display = "block";
    const box = document.getElementById("resultBox");
    box.style.display = "block";
    box.innerHTML = `<h2>Axtarƒ±lƒ±r...</h2>`;

    // 1) VIN yoxlamasƒ±
    if (code.length === 17 && /^[A-HJ-NPR-Z0-9]+$/.test(code)) {
        fetchVIN(code);
        return;
    }

    // 2) Barkod ‚Äì Global bazadan axtarƒ±≈ü
    fetchProduct(code);
}

// VIN API
function fetchVIN(vin) {
    fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/decodevinvalues/${vin}?format=json`)
    .then(r => r.json())
    .then(data => {
        const info = data.Results[0];
        document.getElementById("resultBox").innerHTML = `
            <h2>üöó Avtomobil M…ôlumatƒ±</h2>
            <p><b>Marka:</b> ${info.Make}</p>
            <p><b>Model:</b> ${info.Model}</p>
            <p><b>ƒ∞l:</b> ${info.ModelYear}</p>
            <p><b>Tip:</b> ${info.VehicleType}</p>
        `;
    });
}

// M…ôhsul m…ôlumatlarƒ± ‚Äì Global Open Product API
function fetchProduct(code) {
    fetch(`https://world.openfoodfacts.org/api/v2/product/${code}.json`)
    .then(r => r.json())
    .then(data => {
        if (!data.product) {
            document.getElementById("resultBox").innerHTML = "<h2>M…ôlumat tapƒ±lmadƒ±</h2>";
            return;
        }

        const p = data.product;

        document.getElementById("resultBox").innerHTML = `
            <h2>${p.product_name || "M…ôhsul"}</h2>
            <img src="${p.image_front_url || ""}" class="product-img">
            <p><b>Marka:</b> ${p.brands || "Yoxdur"}</p>
            <p><b>Kategoriya:</b> ${p.categories || "Yoxdur"}</p>
            <p><b>T…ôsvir:</b> ${p.generic_name || "T…ôsvir yoxdur"}</p>
        `;
    });
}

// Geri kameraya qayƒ±t
function goBack() {
    document.getElementById("resultBox").style.display = "none";
    document.getElementById("backBtn").style.display = "none";
    startScanner();
}
</script>

</body>
</html>
