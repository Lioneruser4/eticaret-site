<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anonim Sohbet - GiriÅŸ Oyunu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            -webkit-user-select: none;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 0 20px;
        }

        .logo {
            font-size: 2.8rem;
            margin-bottom: 10px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1rem;
            margin-bottom: 30px;
        }

        /* Game Container */
        .game-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .game-title {
            font-size: 1.6rem;
            text-align: center;
            margin-bottom: 25px;
            color: white;
        }

        .game-instructions {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 25px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Color Grid */
        .color-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 25px;
            flex: 1;
        }

        .color-btn {
            aspect-ratio: 1;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .color-btn:hover {
            transform: scale(1.05);
        }

        .color-btn:active {
            transform: scale(0.95);
        }

        .color-btn.selected {
            animation: pulse 1.5s infinite;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Sequence Display */
        .sequence-display {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .sequence-dot {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .sequence-dot.empty {
            background: rgba(255, 255, 255, 0.1);
            border: 2px dashed rgba(255, 255, 255, 0.3);
        }

        /* Game Controls */
        .game-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .game-btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .game-btn.primary {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
            color: white;
        }

        .game-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .game-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .game-btn:active {
            transform: translateY(0);
        }

        /* Progress Bar */
        .progress-container {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Game Stats */
        .game-stats {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 25px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #4CAF50;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }

        /* Success Screen */
        .success-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 30px;
            text-align: center;
        }

        .success-screen.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .success-icon {
            font-size: 8rem;
            color: #4CAF50;
            margin-bottom: 30px;
            animation: bounce 1s ease infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .success-title {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .success-message {
            font-size: 1.2rem;
            margin-bottom: 40px;
            max-width: 400px;
            line-height: 1.6;
        }

        .continue-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 18px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .continue-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        /* Loading */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 80px;
            height: 80px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .color-grid {
                gap: 12px;
            }
            
            .game-controls {
                flex-direction: column;
            }
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 15px;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 90%;
            text-align: center;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* Screenshot Protection */
        .no-screenshot {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body class="no-screenshot">
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">ðŸŽ®</div>
            <h1>Anonim Sohbet</h1>
            <p class="subtitle">Renk oyunu ile gÃ¼venli giriÅŸ</p>
        </div>

        <!-- Game Container -->
        <div class="game-container">
            <h2 class="game-title" id="gameTitle">Renk Dizmece Oyunu</h2>
            
            <div class="game-instructions" id="instructions">
                <p><strong>NasÄ±l OynanÄ±r:</strong></p>
                <p>1. 4 renkten oluÅŸan bir ÅŸifre belirleyin</p>
                <p>2. Bu ÅŸifreyi hatÄ±rlayÄ±n</p>
                <p>3. Her giriÅŸte aynÄ± ÅŸifreyi girerek doÄŸrulayÄ±n</p>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <!-- Sequence Display -->
            <div class="sequence-display">
                <div class="sequence-dot empty" id="dot1"></div>
                <div class="sequence-dot empty" id="dot2"></div>
                <div class="sequence-dot empty" id="dot3"></div>
                <div class="sequence-dot empty" id="dot4"></div>
            </div>

            <!-- Color Grid -->
            <div class="color-grid" id="colorGrid">
                <!-- Colors will be generated by JavaScript -->
            </div>

            <!-- Game Stats -->
            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-value" id="attemptCount">0</div>
                    <div class="stat-label">Deneme</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="gameStage">1</div>
                    <div class="stat-label">AÅŸama</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="timeLeft">60</div>
                    <div class="stat-label">Saniye</div>
                </div>
            </div>

            <!-- Game Controls -->
            <div class="game-controls">
                <button class="game-btn secondary" id="clearBtn">
                    <i class="fas fa-undo"></i>
                    Temizle
                </button>
                <button class="game-btn primary" id="submitBtn">
                    <i class="fas fa-check"></i>
                    Onayla
                </button>
            </div>
        </div>
    </div>

    <!-- Success Screen -->
    <div class="success-screen" id="successScreen">
        <div class="success-icon">ðŸŽ‰</div>
        <h2 class="success-title">Tebrikler!</h2>
        <p class="success-message" id="successMessage">Åžifreniz baÅŸarÄ±yla oluÅŸturuldu. Anonim sohbet platformuna eriÅŸim saÄŸlanÄ±yor...</p>
        <button class="continue-btn" id="continueBtn">
            <i class="fas fa-arrow-right"></i>
            Sohbete GeÃ§
        </button>
    </div>

    <!-- Loading Screen -->
    <div class="loading" id="loadingScreen">
        <div class="spinner"></div>
        <h2 id="loadingText">YÃ¼kleniyor...</h2>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        // Global deÄŸiÅŸkenler
        let selectedColors = [];
        let gameStage = 1; // 1: Åžifre oluÅŸturma, 2: Åžifre doÄŸrulama
        let userPassword = null;
        let userId = null;
        let userName = null;
        let userTelegramData = null;
        let attempts = 0;
        let timeLeft = 60;
        let timerInterval = null;
        let isFirstVisit = true;

        // Renk paleti
        const colors = [
            { name: 'KÄ±rmÄ±zÄ±', value: '#FF5252', icon: 'â¤ï¸' },
            { name: 'Mavi', value: '#448AFF', icon: 'ðŸ’™' },
            { name: 'YeÅŸil', value: '#4CAF50', icon: 'ðŸ’š' },
            { name: 'SarÄ±', value: '#FFD740', icon: 'ðŸ’›' },
            { name: 'Mor', value: '#7C4DFF', icon: 'ðŸ’œ' },
            { name: 'Turuncu', value: '#FF9800', icon: 'ðŸ§¡' },
            { name: 'Pembe', value: '#FF4081', icon: 'ðŸ’—' },
            { name: 'Turkuaz', value: '#18FFFF', icon: 'ðŸ’ ' }
        ];

        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Sayfa yÃ¼klendi');
            
            // Ekran korumasÄ±
            setupScreenProtection();
            
            // KullanÄ±cÄ± bilgilerini al
            initializeUser();
            
            // Renk grid'ini oluÅŸtur
            createColorGrid();
            
            // Game stage'i kontrol et
            checkGameStage();
            
            // Buton event listener'larÄ±
            document.getElementById('clearBtn').addEventListener('click', clearSelection);
            document.getElementById('submitBtn').addEventListener('click', submitSequence);
            document.getElementById('continueBtn').addEventListener('click', goToChat);
            
            // Timer baÅŸlat
            startTimer();
            
            // Toast gÃ¶ster
            showToast('Renk oyununa hoÅŸ geldiniz!');
        });

        // Ekran yakalama korumasÄ±
        function setupScreenProtection() {
            // KopyalamayÄ± engelle
            document.addEventListener('copy', (e) => e.preventDefault());
            document.addEventListener('cut', (e) => e.preventDefault());
            document.addEventListener('paste', (e) => e.preventDefault());
            
            // SaÄŸ tÄ±k menÃ¼sÃ¼nÃ¼ engelle
            document.addEventListener('contextmenu', (e) => e.preventDefault());
            
            // Klavye kÄ±sayollarÄ±nÄ± engelle
            document.addEventListener('keydown', (e) => {
                if (e.key === 'PrintScreen' || 
                    e.key === 'F12' || 
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) ||
                    (e.ctrlKey && e.key === 'u') ||
                    (e.ctrlKey && e.key === 's')) {
                    e.preventDefault();
                    showToast('Bu iÅŸlem gÃ¼venlik nedeniyle engellendi');
                }
            });
            
            // Developer Tools aÃ§Ä±ldÄ±ÄŸÄ±nda tespit et
            setInterval(() => {
                const threshold = 100;
                const widthDiff = window.outerWidth - window.innerWidth;
                const heightDiff = window.outerHeight - window.innerHeight;
                
                if (widthDiff > threshold || heightDiff > threshold) {
                    showToast('GÃ¼venlik uyarÄ±sÄ±!');
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }
            }, 1000);
        }

        // KullanÄ±cÄ±yÄ± baÅŸlat
        async function initializeUser() {
            try {
                // URL parametrelerini kontrol et (Telegram WebApp)
                const urlParams = new URLSearchParams(window.location.search);
                const tgInitData = urlParams.get('tgInitData');
                
                if (tgInitData) {
                    // Telegram'dan gelen verileri iÅŸle
                    await processTelegramData(tgInitData);
                } else {
                    // Rastgele kullanÄ±cÄ± oluÅŸtur
                    await createRandomUser();
                }
                
                // LocalStorage'dan ÅŸifreyi kontrol et
                checkExistingPassword();
                
            } catch (error) {
                console.error('KullanÄ±cÄ± baÅŸlatma hatasÄ±:', error);
                await createRandomUser();
            }
        }

        // Telegram verilerini iÅŸle
        async function processTelegramData(initData) {
            try {
                const params = new URLSearchParams(initData);
                const userParam = params.get('user');
                
                if (userParam) {
                    const userData = JSON.parse(decodeURIComponent(userParam));
                    userId = `tg_${userData.id}`;
                    userName = userData.first_name || `User_${userData.id}`;
                    
                    if (userData.username) {
                        userName = `@${userData.username}`;
                    }
                    
                    userTelegramData = userData;
                    
                    console.log('Telegram kullanÄ±cÄ±sÄ±:', userData);
                    showToast(`HoÅŸ geldin ${userName}!`);
                }
            } catch (error) {
                console.error('Telegram veri iÅŸleme hatasÄ±:', error);
                throw error;
            }
        }

        // Rastgele kullanÄ±cÄ± oluÅŸtur
        async function createRandomUser() {
            const randomId = Math.random().toString(36).substring(2, 15);
            userId = `anon_${randomId}`;
            userName = `Anonim_${randomId.substring(0, 6)}`;
            
            console.log('Rastgele kullanÄ±cÄ± oluÅŸturuldu:', userId);
        }

        // Mevcut ÅŸifreyi kontrol et
        function checkExistingPassword() {
            const savedPassword = localStorage.getItem(`color_password_${userId}`);
            
            if (savedPassword) {
                userPassword = JSON.parse(savedPassword);
                gameStage = 2; // Åžifre doÄŸrulama moduna geÃ§
                isFirstVisit = false;
                updateGameUI();
            }
        }

        // Game stage'ini kontrol et ve UI'Ä± gÃ¼ncelle
        function checkGameStage() {
            updateGameUI();
        }

        // Game UI'Ä±nÄ± gÃ¼ncelle
        function updateGameUI() {
            const title = document.getElementById('gameTitle');
            const instructions = document.getElementById('instructions');
            const submitBtn = document.getElementById('submitBtn');
            
            if (gameStage === 1) {
                title.textContent = 'Åžifre OluÅŸtur';
                instructions.innerHTML = `
                    <p><strong>Ä°lk defa mÄ± giriyorsunuz?</strong></p>
                    <p>1. 4 renkten oluÅŸan bir ÅŸifre seÃ§in</p>
                    <p>2. Bu ÅŸifreyi unutmayÄ±n!</p>
                    <p>3. Åžifrenizi tekrar girerek doÄŸrulayÄ±n</p>
                `;
                submitBtn.innerHTML = '<i class="fas fa-save"></i> Åžifreyi Kaydet';
            } else {
                title.textContent = 'Åžifrenizi Girin';
                instructions.innerHTML = `
                    <p><strong>HoÅŸ geldiniz!</strong></p>
                    <p>1. Daha Ã¶nce belirlediÄŸiniz 4 renkli ÅŸifreyi girin</p>
                    <p>2. Åžifrenizi unuttuysanÄ±z sayfayÄ± yenileyin</p>
                    <p>3. Her yanlÄ±ÅŸ denemede sÃ¼re azalÄ±r</p>
                `;
                submitBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> GiriÅŸ Yap';
            }
            
            // Ä°statistikleri gÃ¼ncelle
            document.getElementById('gameStage').textContent = gameStage;
        }

        // Renk grid'ini oluÅŸtur
        function createColorGrid() {
            const grid = document.getElementById('colorGrid');
            grid.innerHTML = '';
            
            // 8 renk ekle (4x2 grid)
            colors.forEach((color, index) => {
                const button = document.createElement('button');
                button.className = 'color-btn';
                button.style.background = color.value;
                button.dataset.index = index;
                button.dataset.color = color.value;
                button.dataset.name = color.name;
                
                // Renk etiketi
                const label = document.createElement('div');
                label.style.position = 'absolute';
                label.style.bottom = '5px';
                label.style.left = '0';
                label.style.right = '0';
                label.style.textAlign = 'center';
                label.style.fontSize = '1.5rem';
                label.textContent = color.icon;
                
                button.appendChild(label);
                
                button.addEventListener('click', () => selectColor(color, button));
                grid.appendChild(button);
            });
        }

        // Renk seÃ§
        function selectColor(color, button) {
            if (selectedColors.length >= 4) {
                showToast('Maksimum 4 renk seÃ§ebilirsiniz');
                return;
            }
            
            selectedColors.push(color);
            
            // SeÃ§ili rengi iÅŸaretle
            button.classList.add('selected');
            
            // Sequence dot'larÄ±nÄ± gÃ¼ncelle
            updateSequenceDots();
            
            // Progress bar'Ä± gÃ¼ncelle
            updateProgressBar();
            
            // Butonun animasyonunu baÅŸlat
            button.style.animation = 'pulse 0.3s ease';
            setTimeout(() => {
                button.style.animation = '';
            }, 300);
        }

        // Sequence dot'larÄ±nÄ± gÃ¼ncelle
        function updateSequenceDots() {
            for (let i = 1; i <= 4; i++) {
                const dot = document.getElementById(`dot${i}`);
                
                if (i <= selectedColors.length) {
                    const color = selectedColors[i - 1];
                    dot.style.background = color.value;
                    dot.classList.remove('empty');
                    dot.innerHTML = `<span style="font-size: 0.8rem; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">${color.icon}</span>`;
                } else {
                    dot.style.background = '';
                    dot.classList.add('empty');
                    dot.innerHTML = '';
                }
            }
        }

        // Progress bar'Ä± gÃ¼ncelle
        function updateProgressBar() {
            const progress = (selectedColors.length / 4) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }

        // SeÃ§imi temizle
        function clearSelection() {
            selectedColors = [];
            
            // TÃ¼m renk butonlarÄ±ndan selected class'Ä±nÄ± kaldÄ±r
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // Sequence dot'larÄ±nÄ± sÄ±fÄ±rla
            updateSequenceDots();
            
            // Progress bar'Ä± sÄ±fÄ±rla
            updateProgressBar();
            
            showToast('SeÃ§im temizlendi');
        }

        // Sequence'i gÃ¶nder
        function submitSequence() {
            if (selectedColors.length !== 4) {
                showToast('LÃ¼tfen tam olarak 4 renk seÃ§in');
                return;
            }
            
            attempts++;
            document.getElementById('attemptCount').textContent = attempts;
            
            if (gameStage === 1) {
                // Åžifre oluÅŸturma modu
                handlePasswordCreation();
            } else {
                // Åžifre doÄŸrulama modu
                handlePasswordVerification();
            }
        }

        // Åžifre oluÅŸturma
        function handlePasswordCreation() {
            if (!userPassword) {
                // Ä°lk ÅŸifre oluÅŸturma
                userPassword = selectedColors.map(c => c.value);
                showToast('Åžifreniz oluÅŸturuldu. Åžimdi tekrar girin.');
                
                // Stage 2'ye geÃ§
                gameStage = 2;
                updateGameUI();
                clearSelection();
            } else {
                // Åžifreyi doÄŸrula
                const newPassword = selectedColors.map(c => c.value);
                const isMatch = JSON.stringify(userPassword) === JSON.stringify(newPassword);
                
                if (isMatch) {
                    // Åžifre doÄŸrulandÄ±, kaydet
                    savePassword();
                    showSuccessScreen('Åžifreniz baÅŸarÄ±yla doÄŸrulandÄ±!');
                } else {
                    // Åžifre yanlÄ±ÅŸ
                    handleWrongPassword();
                }
            }
        }

        // Åžifre doÄŸrulama
        function handlePasswordVerification() {
            const enteredPassword = selectedColors.map(c => c.value);
            const isMatch = JSON.stringify(userPassword) === JSON.stringify(enteredPassword);
            
            if (isMatch) {
                // Åžifre doÄŸrulandÄ±
                showSuccessScreen('GiriÅŸ baÅŸarÄ±lÄ±!');
            } else {
                // Åžifre yanlÄ±ÅŸ
                handleWrongPassword();
            }
        }

        // YanlÄ±ÅŸ ÅŸifre iÅŸleme
        function handleWrongPassword() {
            showToast('YanlÄ±ÅŸ ÅŸifre! Tekrar deneyin.');
            
            // SÃ¼reyi azalt
            timeLeft = Math.max(10, timeLeft - 10);
            updateTimerDisplay();
            
            // Hata animasyonu
            document.querySelectorAll('.sequence-dot').forEach(dot => {
                dot.style.animation = 'none';
                setTimeout(() => {
                    dot.style.animation = 'pulse 0.5s ease';
                }, 10);
            });
            
            clearSelection();
        }

        // Åžifreyi kaydet
        function savePassword() {
            localStorage.setItem(`color_password_${userId}`, JSON.stringify(userPassword));
            localStorage.setItem(`user_id`, userId);
            localStorage.setItem(`user_name`, userName);
            
            // Telegram verisini de kaydet
            if (userTelegramData) {
                localStorage.setItem(`telegram_data`, JSON.stringify(userTelegramData));
            }
            
            console.log('Åžifre kaydedildi:', userPassword);
        }

        // BaÅŸarÄ± ekranÄ±nÄ± gÃ¶ster
        function showSuccessScreen(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successScreen').classList.add('active');
            
            // Timer'Ä± durdur
            clearInterval(timerInterval);
            
            // KullanÄ±cÄ± verilerini sunucuya kaydet
            saveUserToServer();
        }

        // KullanÄ±cÄ±yÄ± sunucuya kaydet
        async function saveUserToServer() {
            showLoading('Sisteme kaydediliyor...');
            
            try {
                // KullanÄ±cÄ± verilerini hazÄ±rla
                const userData = {
                    userId: userId,
                    userName: userName,
                    telegramData: userTelegramData,
                    gameCompleted: true,
                    timestamp: Date.now(),
                    colorPassword: userPassword
                };
                
                // LocalStorage'a kaydet
                localStorage.setItem('user_data', JSON.stringify(userData));
                
                // Sunucuya POST isteÄŸi gÃ¶nder
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(userData)
                });
                
                if (!response.ok) {
                    throw new Error('Sunucu kaydÄ± baÅŸarÄ±sÄ±z');
                }
                
                const result = await response.json();
                console.log('Sunucu kaydÄ± baÅŸarÄ±lÄ±:', result);
                
                hideLoading();
                
            } catch (error) {
                console.error('Sunucu kaydÄ± hatasÄ±:', error);
                hideLoading();
                showToast('BaÄŸlantÄ± hatasÄ±, offline modda devam ediliyor');
            }
        }

        // Sohbet sayfasÄ±na geÃ§
        function goToChat() {
            showLoading('Sohbet platformuna yÃ¶nlendiriliyor...');
            
            setTimeout(() => {
                // Sohbet sayfasÄ±na yÃ¶nlendir
                window.location.href = '/chat.html?userId=' + encodeURIComponent(userId);
            }, 2000);
        }

        // Timer baÅŸlat
        function startTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    showToast('SÃ¼re doldu! Sayfa yenileniyor...');
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                } else if (timeLeft <= 10) {
                    // Son 10 saniye uyarÄ±sÄ±
                    document.getElementById('timeLeft').style.color = '#FF5252';
                }
            }, 1000);
        }

        // Timer display'ini gÃ¼ncelle
        function updateTimerDisplay() {
            document.getElementById('timeLeft').textContent = timeLeft;
        }

        // Toast gÃ¶ster
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // Loading gÃ¶ster
        function showLoading(text = 'YÃ¼kleniyor...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingScreen').classList.add('active');
        }

        // Loading gizle
        function hideLoading() {
            document.getElementById('loadingScreen').classList.remove('active');
        }

        // Sayfadan Ã§Ä±kÄ±ÅŸta temizlik
        window.addEventListener('beforeunload', function() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
        });

        // Online/offline durumunu takip et
        window.addEventListener('online', () => {
            showToast('Ä°nternet baÄŸlantÄ±sÄ± saÄŸlandÄ±');
        });

        window.addEventListener('offline', () => {
            showToast('Ä°nternet baÄŸlantÄ±sÄ± kesildi');
        });
    </script>
</body>
</html>
