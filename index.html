<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M…ôl…ôk</title>

<style>
body {
  margin:0;
  background:#0e1621;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  color:#fff;
  display:flex;
  flex-direction:column;
  height:100vh;
}
#chat {
  flex:1;
  overflow-y:auto;
  padding:12px;
  display:flex;
  flex-direction:column;
}
.msg {
  max-width:80%;
  padding:10px 14px;
  margin:4px 0;
  border-radius:18px;
  font-size:15px;
  line-height:1.35;
}
.user {
  align-self:flex-end;
  background:#6ea4ff;
  color:#000;
}
.ai {
  align-self:flex-start;
  background:#1a2b4c;
}
#typing {
  padding:6px 14px;
  color:#00ffff;
  font-size:18px;
  display:none;
}
#input {
  display:flex;
  padding:10px;
  background:#111b2a;
}
#input input {
  flex:1;
  border:none;
  outline:none;
  border-radius:20px;
  padding:10px 14px;
  font-size:16px;
}
#input button {
  margin-left:8px;
  background:#6ea4ff;
  border:none;
  border-radius:50%;
  width:42px;
  height:42px;
  font-size:18px;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="chat"></div>
<div id="typing">M…ôl…ôk yazƒ±r‚Ä¶</div>

<div id="input">
  <input id="text" placeholder="Mesaj yaz‚Ä¶" />
  <button onclick="send()">‚û§</button>
</div>

<script>
const chat = document.getElementById("chat");
const typing = document.getElementById("typing");
const input = document.getElementById("text");

let memory = JSON.parse(localStorage.getItem("melek_memory") || "[]");
let sending = false;

// Telegram user
let tgName = "dostum";
if (window.Telegram?.WebApp?.initDataUnsafe?.user?.first_name) {
  tgName = Telegram.WebApp.initDataUnsafe.user.first_name;
}

// mesaj g√∂st…ôr
function add(text, cls){
  const d = document.createElement("div");
  d.className = "msg " + cls;
  d.textContent = text;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

// AI √ßaƒüƒ±rƒ±≈üƒ± (REAL)
async function askAI(prompt){
  const system =
`S…ôn M…ôl…ôk adlƒ± dostca AI-san.
Sahibin v…ô s…ôni kodlayan: Xaliq Mustafayev.
Telegram v…ô Instagram: @xaliqmustafayev.
ƒ∞stifad…ô√ßinin adƒ±: ${tgName}.
Qƒ±sa, s…ômimi v…ô GPT kimi cavab ver.
√áox uzun yazma.`;

  const fullPrompt = system + "\n\n∆èvv…ôlki mesajlar:\n" +
    memory.slice(-6).join("\n") +
    "\n\nƒ∞stifad…ô√ßi: " + prompt + "\nM…ôl…ôk:";

  const url =
    "https://text.pollinations.ai/" +
    encodeURIComponent(fullPrompt);

  const res = await fetch(url);
  return await res.text();
}

async function send(){
  if (sending) return;
  const text = input.value.trim();
  if (!text) return;

  sending = true;
  input.value = "";
  add(text,"user");
  memory.push("ƒ∞stifad…ô√ßi: "+text);

  typing.style.display="block";

  try{
    const ai = await askAI(text);
    typing.style.display="none";
    add(ai,"ai");
    memory.push("M…ôl…ôk: "+ai);
    localStorage.setItem("melek_memory", JSON.stringify(memory));
  }catch{
    typing.style.display="none";
    add("Bir az ili≈üdi, yen…ô yaz üôÇ","ai");
  }

  setTimeout(()=>sending=false,700);
}

// Enter
input.addEventListener("keydown",e=>{
  if(e.key==="Enter") send();
});

// Telegram full screen
if (window.Telegram?.WebApp) {
  Telegram.WebApp.expand();
}
</script>

</body>
</html>
