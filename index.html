<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>3D Strike: Mobile TDM</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial', sans-serif; touch-action: none; }
        #ui { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        
        /* HUD (Göstergeler) */
        .hud-info { position: absolute; top: 20px; left: 20px; color: #fff; font-size: 18px; text-shadow: 2px 2px 5px #000; }
        .ammo-box { position: absolute; bottom: 20px; right: 20px; color: #ffeb3b; font-size: 30px; font-weight: bold; }
        
        /* Mobil Kontroller */
        .joystick { position: absolute; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border: 2px solid #fff; border-radius: 50%; pointer-events: auto; }
        .fire-btn { position: absolute; bottom: 50px; right: 150px; width: 100px; height: 100px; background: rgba(255,0,0,0.4); border: 4px solid #f00; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; pointer-events: auto; }
        .reload-btn { position: absolute; bottom: 160px; right: 60px; width: 70px; height: 70px; background: rgba(0,0,255,0.4); border: 2px solid #00f; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; pointer-events: auto; }
        
        #crosshair { position: absolute; top: 50%; left: 50%; width: 20px; height: 20px; border: 2px solid rgba(0,255,0,0.5); transform: translate(-50%, -50%); border-radius: 50%; }
        #msg { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #f00; font-size: 40px; display: none; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="hud-info" id="stats">CAN: 100 | SKOR: 0</div>
        <div id="crosshair"></div>
        <div id="msg">YENİDEN DOĞULUYOR...</div>
        <div class="ammo-box" id="ammo">30 / ∞</div>

        <div id="joy" class="joystick"></div>
        <div id="btn-fire" class="fire-btn">ATEŞ</div>
        <div id="btn-reload" class="reload-btn">R (Yükle)</div>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } }
    </script>

    <script type="module">
        import * as THREE from 'three';

        // --- AYARLAR ---
        let health = 100, score = 0, ammo = 30, isReloading = false;
        const enemies = [];
        const boxes = [];
        
        // --- SAHNE KURULUMU ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x222222);
        scene.fog = new THREE.Fog(0x222222, 10, 50);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // --- HARİTA (TDM ALANI) ---
        const floor = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0x333333}));
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        // Kutu Nesneleri (Siperler)
        function createBox(x, z) {
            const box = new THREE.Mesh(new THREE.BoxGeometry(2, 2, 2), new THREE.MeshStandardMaterial({color: 0x555555}));
            box.position.set(x, 1, z);
            scene.add(box);
            boxes.push(box);
        }
        for(let i=0; i<20; i++) createBox(Math.random()*40-20, Math.random()*40-20);

        // --- OYUNCU (AJAN) ---
        const player = new THREE.Group();
        const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.5, 1, 4, 8), new THREE.MeshStandardMaterial({color: 0x0000ff}));
        body.position.y = 1;
        player.add(body);
        scene.add(player);

        // --- DÜŞMAN NPC ---
        function spawnEnemy() {
            const enemy = new THREE.Group();
            const eBody = new THREE.Mesh(new THREE.CapsuleGeometry(0.5, 1, 4, 8), new THREE.MeshStandardMaterial({color: 0xff0000}));
            eBody.position.y = 1;
            enemy.add(eBody);
            enemy.position.set(Math.random()*40-20, 0, Math.random()*40-20);
            enemy.userData = { health: 3 }; // 3 mermide ölür
            scene.add(enemy);
            enemies.push(enemy);
        }
        for(let i=0; i<5; i++) spawnEnemy();

        // --- SİLAH SİSTEMİ (ATEŞ ETME) ---
        function fire() {
            if (ammo <= 0 || isReloading) { reload(); return; }
            ammo--;
            updateHUD();

            // Mermi Görseli (Işın)
            const raycaster = new THREE.Raycaster();
            const direction = new THREE.Vector3();
            camera.getWorldDirection(direction);
            raycaster.set(player.position, direction);

            const intersects = raycaster.intersectObjects(enemies, true);
            if (intersects.length > 0) {
                const target = intersects[0].object.parent;
                target.userData.health--;
                if(target.userData.health <= 0) {
                    score += 10;
                    target.position.set(Math.random()*40-20, 0, Math.random()*40-20); // Respawn
                    target.userData.health = 3;
                }
            }
        }

        function reload() {
            if(isReloading) return;
            isReloading = true;
            document.getElementById('ammo').innerText = "YÜKLENİYOR...";
            setTimeout(() => {
                ammo = 30;
                isReloading = false;
                updateHUD();
            }, 2000);
        }

        function updateHUD() {
            document.getElementById('stats').innerText = `CAN: ${health} | SKOR: ${score}`;
            document.getElementById('ammo').innerText = `${ammo} / ∞`;
        }

        // --- KONTROLLER ---
        let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
        
        // Klavye
        window.onkeydown = (e) => {
            if(e.key == 'w') moveForward = true;
            if(e.key == 's') moveBackward = true;
            if(e.key == 'a') moveLeft = true;
            if(e.key == 'd') moveRight = true;
            if(e.key == 'r') reload();
        };
        window.onkeyup = (e) => {
            if(e.key == 'w') moveForward = false;
            if(e.key == 's') moveBackward = false;
            if(e.key == 'a') moveLeft = false;
            if(e.key == 'd') moveRight = false;
        };

        // Mobil Dokunmatik
        document.getElementById('btn-fire').addEventListener('pointerdown', fire);
        document.getElementById('btn-reload').addEventListener('pointerdown', reload);

        // Kamera ve Fare Kontrolü (Mobil ve PC için bakış)
        let yaw = 0, pitch = 0;
        window.addEventListener('mousemove', (e) => {
            if(document.pointerLockElement) {
                yaw -= e.movementX * 0.002;
                pitch -= e.movementY * 0.002;
                pitch = Math.max(-Math.PI/3, Math.min(Math.PI/3, pitch));
            }
        });
        renderer.domElement.onclick = () => renderer.domElement.requestPointerLock();

        // --- OYUN DÖNGÜSÜ ---
        function animate() {
            requestAnimationFrame(animate);

            // Hareket
            const speed = 0.15;
            if (moveForward) player.translateZ(-speed);
            if (moveBackward) player.translateZ(speed);
            if (moveLeft) player.translateX(-speed);
            if (moveRight) player.translateX(speed);

            player.rotation.y = yaw;

            // Kamera Takibi (PUBG Style TPS)
            const camOffset = new THREE.Vector3(0, 2, 5).applyQuaternion(player.quaternion);
            camera.position.lerp(player.position.clone().add(camOffset), 0.1);
            camera.lookAt(player.position.clone().add(new THREE.Vector3(0, 1.5, 0)));

            updateHUD();
            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
