<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profesyonel Animasyonlu QR Kod Oluşturucu</title>
    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <style>
        /* Modern, Kurumsal ve Temiz Stil */
        :root {
            --primary-color: #007bff; /* Mavi/Kurumsal renk */
            --text-color: #333;
            --bg-color: #f8f9fa; /* Açık gri arka plan */
            --card-bg: #fff;
            --border-color: #dee2e6;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }

        .container {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            transition: transform 0.3s ease;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
        }

        /* Giriş ve Seçim Alanları */
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input[type="text"], select, input[type="file"] {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus, select:focus, input[type="file"]:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .controls {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .control-group {
            flex: 1;
        }

        /* Buton Stili */
        button {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            font-weight: 600;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:active {
            transform: scale(0.99);
        }

        /* QR Kod Alanı */
        #qrcode-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            padding: 20px;
            border: 1px dashed var(--border-color);
            border-radius: 8px;
            min-height: 300px; /* Görsel alan koruması */
            background-color: var(--card-bg);
        }

        /* QR Kodu Özelleştirme ve Animasyon CSS'i */
        #qrcode-container svg path {
            /* QR kodun siyah noktaları (modülleri) bu path'lerdir. */
            fill: url(#pattern-image) !important; /* SVG pattern'i ile doldur */
            /* Basit Animasyon (Örn: Hafif sallanma/titreşim) */
            animation: pulse 1.5s infinite alternate; 
            transform-origin: center center;
        }

        /* Animasyon Keyframes */
        @keyframes pulse {
            0% { transform: scale(1); }
            100% { transform: scale(1.01); }
        }

        /* Yükleme mesajı */
        #loading-message {
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }

    </style>
</head>
<body>

<div class="container">
    <h1>✨ Profesyonel Animasyonlu QR Kod Oluşturucu</h1>
    <hr>

    <label for="linkInput">Hedef Link:</label>
    <input type="text" id="linkInput" placeholder="Örn: github.com/kullaniciadi">

    <label for="imageUpload">QR Kod Dolgu Resmi (JPEG/PNG):</label>
    <input type="file" id="imageUpload" accept="image/png, image/jpeg">

    <div class="controls">
        <div class="control-group">
            <label for="sizeSelect">Boyut (px):</label>
            <select id="sizeSelect">
                <option value="256">256x256</option>
                <option value="512" selected>512x512</option>
                <option value="1024">1024x1024</option>
            </select>
        </div>
        <div class="control-group">
            <label for="errorSelect">Hata Düzeltme Seviyesi:</label>
            <select id="errorSelect">
                <option value="L">Düşük (L - %7)</option>
                <option value="M" selected>Orta (M - %15)</option>
                <option value="Q">Yüksek (Q - %25)</option>
                <option value="H">Çok Yüksek (H - %30)</option>
            </select>
        </div>
    </div>

    <button onclick="generateQRCode()">QR Kodu Oluştur ve Özelleştir</button>

    <div id="qrcode-container">
        <p id="loading-message">Lütfen linki ve dolgu resmini girip 'Oluştur'a tıklayın.</p>
    </div>

</div>

<script>
    const qrCodeContainer = document.getElementById('qrcode-container');
    const imageUpload = document.getElementById('imageUpload');
    const linkInput = document.getElementById('linkInput');
    const sizeSelect = document.getElementById('sizeSelect');
    const errorSelect = document.getElementById('errorSelect');
    
    // QR Kodu oluşturma fonksiyonu
    function generateQRCode() {
        const link = linkInput.value.trim();
        const file = imageUpload.files[0];
        const size = parseInt(sizeSelect.value);
        const errorLevel = errorSelect.value;

        if (!link) {
            alert("Lütfen bir hedef link girin.");
            return;
        }

        if (!file) {
            alert("Lütfen QR kodun siyah kısımlarını dolduracak bir resim yükleyin.");
            return;
        }

        // 1. Linki kontrol et ve 'https://' ekle
        let safeLink = link;
        if (!safeLink.match(/^(https?|ftp):\/\//i)) {
            safeLink = 'https://' + safeLink;
        }

        // 2. Önce resmi Base64'e çevir (SVG pattern'i için gerekli)
        const reader = new FileReader();
        reader.onload = function(e) {
            const imageDataUrl = e.target.result;
            
            // 3. QR Kodu Oluştur
            qrCodeContainer.innerHTML = ''; // Önceki kodu temizle

            new QRCode(qrCodeContainer, {
                text: safeLink,
                width: size,
                height: size,
                colorDark: "#000000", // qrcode.js'in varsayılanı, daha sonra SVG ile değişecek
                colorLight: "#ffffff",
                correctLevel: errorLevel 
            });

            // 4. SVG'yi al ve özelleştir
            // qrcode.js'in içine yerleştirdiği SVG elementini bul
            const svgElement = qrCodeContainer.querySelector('svg');
            
            if (svgElement) {
                // QR Kodun siyah kısımlarını (path'leri) resimle doldurmak için SVG Pattern oluşturuyoruz.
                const patternId = 'pattern-image';
                
                // SVG'ye <defs> ve <pattern> elementlerini ekle
                const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                
                // Pattern (Deseni) oluştur: Tüm SVG alanını kaplayacak
                const pattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
                pattern.setAttribute('id', patternId);
                pattern.setAttribute('width', '100%'); // Desen, QR kodun tüm genişliğini kaplasın
                pattern.setAttribute('height', '100%'); // Desen, QR kodun tüm yüksekliğini kaplasın
                pattern.setAttribute('patternContentUnits', 'objectBoundingBox'); // Koordinat sistemi (0-1 aralığında)

                // Resim elementini oluştur
                const image = document.createElementNS('http://www.w3.org/2000/svg', 'image');
                image.setAttribute('href', imageDataUrl); // Base64 resim verisi
                image.setAttribute('x', '0');
                image.setAttribute('y', '0');
                image.setAttribute('width', '1'); // PatternContentUnits olduğu için 1 = %100
                image.setAttribute('height', '1');
                image.setAttribute('preserveAspectRatio', 'xMidYMid slice'); // Resmi keserek sığdır (tüm QR kod alanını kaplaması için)

                pattern.appendChild(image);
                defs.appendChild(pattern);
                svgElement.prepend(defs); // defs'i SVG'nin en başına ekle
                
                // CSS, bu <pattern-image> ile QR kodun 'path'lerini doldurur.
                // Not: CSS'deki `fill: url(#pattern-image) !important;` kuralı bu işlemi gerçekleştirir.
            } else {
                alert("QR kodu oluşturulurken bir hata oluştu (SVG bulunamadı).");
            }

        };

        // Base64 dönüşümünü başlat
        reader.readAsDataURL(file);
    }
</script>

</body>
</html>
