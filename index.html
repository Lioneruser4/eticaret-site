<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XSCAN â€“ Global Scanner</title>

<!-- Quagga2 (barkod) -->
<script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>

<!-- ZXing (QR + barkod) -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

<!-- Tesseract OCR (VIN Ã¼Ã§Ã¼n) -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>

<style>
    body {
        background: #0c0f16;
        color: white;
        font-family: Arial;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    .title {
        margin-top: 40px;
        font-size: 38px;
        font-weight: bold;
        animation: glow 3s infinite;
    }
    @keyframes glow {
        0% { text-shadow: 0 0 10px #00eaff; }
        50% { text-shadow: 0 0 25px #00f7ff; }
        100% { text-shadow: 0 0 10px #00eaff; }
    }
    button {
        margin-top: 20px;
        padding: 15px 30px;
        font-size: 18px;
        background: #00eaff;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: .3s;
    }
    button:hover {
        background: #00c9dd;
    }
    #video {
        width: 90%;
        margin-top: 20px;
        border-radius: 10px;
        display: none;
        border: 3px solid #00eaff;
    }
    .result {
        display: none;
        margin-top: 25px;
        padding: 18px;
        background: rgba(255,255,255,0.08);
        border-radius: 12px;
        animation: fade .6s;
    }
    @keyframes fade {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .vin-box {
        margin-top: 25px;
    }
    input {
        padding: 10px;
        width: 70%;
        border-radius: 8px;
        border: none;
        margin-top: 10px;
    }
</style>

</head>
<body>

<div class="title">XSCAN PRO</div>
<p>DÃ¼nyanÄ±n bÃ¼tÃ¼n barkod, QR vÉ™ VIN kodlarÄ±nÄ± oxuyan sistem</p>

<button onclick="startCamera()">ðŸ“· Kamera ilÉ™ oxut</button>

<div class="vin-box">
    <h3>VIN kod daxil et:</h3>
    <input id="vinInput" placeholder="MÉ™s: 1HGCM82633A123456">
    <button onclick="decodeVIN()">VIN analiz</button>
</div>

<video id="video" autoplay></video>

<div id="result" class="result"></div>

<script>
let video = document.getElementById("video");
let resultBox = document.getElementById("result");
let codeReader = new ZXing.BrowserMultiFormatReader();
let cameraStream;

// Kamera baÅŸlat
async function startCamera() {
    resultBox.style.display = "none";

    try {
        cameraStream = await navigator.mediaDevices.getUserMedia({ 
            video: { facingMode: "environment" } 
        });

        video.style.display = "block";
        video.srcObject = cameraStream;

        codeReader.decodeFromVideoDevice(null, "video", (res, err) => {
            if (res) {
                stopCamera();
                fetchProductData(res.text);
            }
        });

    } catch (e) {
        alert("Kamera aÃ§Ä±la bilmÉ™di!");
    }
}

// KameranÄ± dayandÄ±r
function stopCamera() {
    if (cameraStream) {
        cameraStream.getTracks().forEach(track => track.stop());
    }
    video.style.display = "none";
}

// MÉ™hsul API-lÉ™ri
async function fetchProductData(code) {
    resultBox.style.display = "block";
    resultBox.innerHTML = `<h2>Kod: ${code}</h2><p>AxtarÄ±lÄ±r...</p>`;

    const apis = [
        `https://world.openfoodfacts.org/api/v0/product/${code}.json`,
        `https://world.openbeautyfacts.org/api/v0/product/${code}.json`,
        `https://world.openproducts.org/api/v0/product/${code}.json`,
        `https://api.upcitemdb.com/prod/trial/lookup?upc=${code}`
    ];

    for (let url of apis) {
        try {
            let r = await fetch(url);
            let data = await r.json();

            if (data.product && data.product.product_name) {
                showProduct(data.product.product_name, data.product.brands, code);
                return;
            }

            if (data.items && data.items.length > 0) {
                showProduct(data.items[0].title, data.items[0].brand, code);
                return;
            }

        } catch (err) {}
    }

    resultBox.innerHTML = `
        <h2>Kod: ${code}</h2>
        <p>MÉ™hsul tapÄ±lmadÄ±.</p>
    `;
}

// MÉ™lumat gÃ¶stÉ™r
function showProduct(name, brand, code) {
    resultBox.innerHTML = `
        <h2>MÉ™hsul TapÄ±ldÄ± âœ”</h2>
        <p><b>Ad:</b> ${name}</p>
        <p><b>Brend:</b> ${brand}</p>
        <p><b>Kod:</b> ${code}</p>
    `;
}

// VIN analiz
async function decodeVIN() {
    let vin = document.getElementById("vinInput").value;
    if (vin.length < 10) return alert("VIN dÃ¼zgÃ¼n deyil!");

    let url = `https://vpic.nhtsa.dot.gov/api/vehicles/decodevin/${vin}?format=json`;

    let r = await fetch(url);
    let data = await r.json();

    let make = data.Results.find(e => e.Variable == "Make")?.Value;
    let model = data.Results.find(e => e.Variable == "Model")?.Value;
    let year = data.Results.find(e => e.Variable == "Model Year")?.Value;

    resultBox.style.display = "block";
    resultBox.innerHTML = `
        <h2>VIN analizi âœ”</h2>
        <p><b>Marka:</b> ${make}</p>
        <p><b>Model:</b> ${model}</p>
        <p><b>Ä°l:</b> ${year}</p>
        <p><b>VIN:</b> ${vin}</p>
    `;
}
</script>

</body>
</html>
