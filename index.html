<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ProQR – Siyah Yerine Resminiz</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:#f9fafb;color:#1e293b;line-height:1.6}
    .container{max-width:900px;margin:40px auto;padding:0 20px}
    .card{background:#fff;border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,0.07);overflow:hidden}
    .header{text-align:center;padding:50px 30px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}
    h1{font-size:2.8rem;font-weight:700;margin-bottom:8px}
    .content{padding:50px}
    .form-group{margin-bottom:28px}
    label{display:block;font-weight:600;margin-bottom:10px;color:#374151}
    input,select{width:100%;padding:14px 16px;border:1px solid #cbd5e1;border-radius:12px;font-size:1rem}
    input:focus,select:focus{outline:none;border-color:#6366f1;box-shadow:0 0 0 3px rgba(99,102,241,0.15)}
    .upload{border:2px dashed #94a3b8;border-radius:16px;padding:50px;text-align:center;cursor:pointer;transition:.3s;background:#f8fafc}
    .upload:hover{border-color:#6366f1;background:#f0f4ff}
    #preview{max-width:160px;margin:20px auto;border-radius:12px;display:none;box-shadow:0 8px 25px rgba(0,0,0,0.15)}
    .btn{
      background:#6366f1;color:#fff;border:none;padding:16px 32px;font-size:1.1rem;font-weight:600;
      border-radius:12px;cursor:pointer;width:100%;transition:.3s;margin-top:20px
    }
    .btn:hover{background:#4f46e5;transform:translateY(-2px);box-shadow:0 10px 25px rgba(99,102,241,0.3)}
    .preview-area{text-align:center;padding:60px 40px;background:#f8fafc}
    #qrCanvas{margin:30px auto;display:inline-block;background:#fff;padding:20px;border-radius:20px;
             box-shadow:0 10px 40px rgba(0,0,0,0.1)}
    canvas{border-radius:16px}
    .download{background:#10b981;display:none;margin-top:20px}
    .download:hover{background:#059669}
    footer{text-align:center;padding:40px;color:#64748b;font-size:0.95rem}
  </style>
</head>
<body>

<div class="container">
  <div class="card">
    <div class="header">
      <h1>ProQR</h1>
      <p>QR kodun siyah kısımları tamamen sizin resminizden oluşur</p>
    </div>

    <div class="content">
      <div class="form-group">
        <label>Hedef Link (http veya https fark etmez)</label>
        <input type="text" id="url" placeholder="instagram.com/kullanicin" value="">
      </div>

      <div class="form-group">
        <label>Siyah Kısmı Oluşturacak Resim (renkli/şeffaf PNG en iyi)</label>
        <div class="upload" id="upload">
          <p>Tıkla veya resmi buraya sürükle</p>
          <img id="preview">
          <input type="file" id="file" accept="image/*" hidden>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
        <div class="form-group">
          <label>Boyut</label>
          <select id="size">
            <option value="400">400×400</option>
            <option value="600" selected>600×600 (Tavsiye)</option>
            <option value="800">800×800</option>
          </select>
        </div>
        <div class="form-group">
          <label>Hata Düzeltme</label>
          <select id="error">
            <option value="M">Orta</option>
            <option value="Q">Yüksek</option>
            <option value="H" selected>En Yüksek (Tavsiye)</option>
          </select>
        </div>
      </div>

      <button class="btn" onclick="olustur()">QR KOD OLUŞTUR</button>
    </div>

    <div class="preview-area">
      <h2 style="margin-bottom:20px">Oluşturulan QR Kod</h2>
      <div id="qrCanvas"></div>
      <button class="btn download" id="download" onclick="downloadQR()">
        Yüksek Kalite PNG İndir
      </button>
    </div>
  </div>

  <footer>ProQR • 2025 • Sınırsız ve tamamen ücretsiz</footer>
</div>

<script src="https://cdn.jsdelivr.net/npm/qr-code-with-image-dots@1.0.4/dist/qr-code-with-image-dots.min.js"></script>
<script>
let qr = null;
let imageData = null;

document.getElementById('upload').onclick = () => document.getElementById('file').click();
document.getElementById('file').onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    imageData = ev.target.result;
    document.getElementById('preview').src = imageData;
    document.getElementById('preview').style.display = 'block';
  }
  reader.readAsDataURL(file);
}

// Drag & drop
['dragenter','dragover','drop'].forEach(ev => document.getElementById('upload').addEventListener(ev, e=>e.preventDefault()));
document.getElementById('upload').addEventListener('drop', e => {
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = ev => {
      imageData = ev.target.result;
      document.getElementById('preview').src = imageData;
      document.getElementById('preview').style.display = 'block';
    }
    reader.readAsDataURL(file);
  }
});

function olustur() {
  let url = document.getElementById('url').value.trim();
  if (!url) return alert("Link boş olamaz");
  if (!imageData) return alert("Önce resim yükle");

  // Otomatik http ekle
  if (!/^https?:\/\//i.test(url)) url = 'https://' + url;

  const canvas = document.getElementById('qrCanvas');
  canvas.innerHTML = '<canvas id="qr"></canvas>';

  qr = new QRCodeWithImageDots({
    canvas: document.getElementById('qr'),
    value: url,
    dotImage: imageData,           // İşte sihir burada!
    size: parseInt(document.getElementById('size').value),
    errorCorrectionLevel: document.getElementById('error').value,
    dotScale: 0.95                 // Resmin ne kadar dolgun olacağını ayarlar
  });

  qr.draw();
  document.getElementById('download').style.display = 'block';
}

function downloadQR() {
  const a = document.createElement('a');
  a.href = document.getElementById('qr').toDataURL('image/png');
  a.download = 'resimli-qr.png';
  a.click();
}
</script>
</body>
</html>
