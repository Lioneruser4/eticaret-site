<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XSCAN ENTERPRISE</title>

<!-- PWA APP ICONS -->
<link rel="icon" href="data:," />
<meta name="theme-color" content="#000">

<!-- Material Icons -->
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded" rel="stylesheet" />

<!-- QR + Barkod Scanner -->
<script src="https://unpkg.com/html5-qrcode"></script>

<style>

/* -------------------------------
   GLOBAL STYLES
--------------------------------*/
body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #0a0a0a;
    color: white;
    overflow-x: hidden;
}

/* Glassmorphism */
.glass {
    background: rgba(255,255,255,0.06);
    backdrop-filter: blur(14px);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 15px;
    padding: 15px;
}

/* Page Animations */
.page {
    display: none;
    padding: 20px;
    animation: fadeIn 0.35s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px);}
    to { opacity: 1; transform: translateY(0); }
}

/* Active page */
.activePage {
    display: block !important;
}

/* Header */
header {
    text-align: center;
    padding: 25px 10px;
    background: linear-gradient(to bottom, #151515, #0a0a0a);
    box-shadow: 0 3px 10px rgba(0,0,0,0.4);
}

header .title {
    font-size: 26px;
    font-weight: bold;
}

header .sub {
    margin-top: 5px;
    opacity: .7;
}

/* NAVIGATION BAR */
#bottomNav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #111;
    display: flex;
    justify-content: space-around;
    border-top: 1px solid #333;
    padding: 8px 0;
    z-index: 999;
}

.nav-btn {
    background: none;
    border: none;
    color: #aaa;
    font-size: 13px;
    text-align: center;
}

.nav-btn.active {
    color: #ff6600;
}

.nav-btn span {
    font-size: 26px;
    display: block;
}

/* Scan Button */
.scanButton {
    width: 90%;
    margin: auto;
    background: #ff6600;
    color: white;
    padding: 14px;
    border-radius: 12px;
    font-size: 20px;
    border: none;
    margin-top: 15px;
    cursor: pointer;
}

/* Scanner Box */
#reader {
    width: 100%;
    max-width: 350px;
    margin: auto;
    display: none;
}

/* Result Card */
.productCard {
    margin-top: 20px;
}

.productImg {
    width: 180px;
    border-radius: 12px;
    margin-top: 10px;
}

/* Back button */
.backBtn {
    background: #444;
    padding: 10px 18px;
    color: white;
    border: none;
    border-radius: 12px;
    margin-top: 20px;
    font-size: 16px;
}

</style>

</head>
<body>

<header>
    <div class="title">XSCAN ENTERPRISE</div>
    <div class="sub">Universal Barkod + QR + VIN Analiz Sistemi</div>
</header>

<!-- ============ HOME PAGE ============ -->
<div class="page activePage" id="homePage">
    <div class="glass">
        XSCAN Enterprise bütün barkod, QR və VIN kodlarını oxuyur və məhsul,
        içki, qida, kosmetika, elektronika və avtomobil məlumatlarını global
        bazalardan çəkir.
    </div>

    <button class="scanButton" onclick="goPage('scanPage')">
        Scan Et
    </button>

    <h3>Manual Kod Daxiletmə</h3>
    <input id="manualInput" type="text" placeholder="Barkod və ya VIN yaz" 
        style="width:90%;padding:12px;border-radius:10px;border:none;margin-top:10px;">
    <button class="scanButton" onclick="manualLookup()">Axtar</button>
</div>

<!-- ============ SCAN PAGE ============ -->
<div class="page" id="scanPage">
    <div id="reader"></div>
    <button class="backBtn" onclick="stopScan();goPage('homePage')">Geri</button>
</div>

<!-- ============ RESULT PAGE ============ -->
<div class="page" id="resultPage">
    <div id="resultBox" class="glass"></div>
    <button class="backBtn" onclick="goPage('homePage')">Ana Səhifə</button>
</div>

<!-- ============ HISTORY PAGE ============ -->
<div class="page" id="historyPage">
    <h2>Keçmiş Oxutmalar</h2>
    <div id="historyList" class="glass"></div>
</div>


<!-- BOTTOM NAV -->
<nav id="bottomNav">
    <button class="nav-btn active" onclick="goPage('homePage')" id="navHome">
        <span class="material-symbols-rounded">home</span>
        Home
    </button>

    <button class="nav-btn" onclick="goPage('scanPage')" id="navScan">
        <span class="material-symbols-rounded">qr_code_scanner</span>
        Scan
    </button>

    <button class="nav-btn" onclick="goPage('historyPage')" id="navHistory">
        <span class="material-symbols-rounded">history</span>
        History
    </button>
</nav>


<script>

/* ==============================================
   PAGE NAVIGATION
================================================*/
function goPage(pageId){
    document.querySelectorAll(".page").forEach(p => p.classList.remove("activePage"));
    document.getElementById(pageId).classList.add("activePage");

    document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
    if(pageId === "homePage") navHome.classList.add("active");
    if(pageId === "scanPage") navScan.classList.add("active");
    if(pageId === "historyPage") navHistory.classList.add("active");

    if(pageId === "scanPage") startScan();
    else stopScan();
}


/* ==============================================
   SCANNER
================================================*/
let scanner;

function startScan(){
    document.getElementById("reader").style.display = "block";

    scanner = new Html5Qrcode("reader");

    scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },

        decoded => {
            stopScan();
            fetchData(decoded);
            saveHistory(decoded);
        }
    );
}

function stopScan(){
    if(scanner){
        scanner.stop();
        scanner.clear();
    }
    document.getElementById("reader").style.display = "none";
}


/* ==============================================
   MANUAL INPUT
================================================*/
function manualLookup(){
    const code = manualInput.value.trim();
    if(!code) return alert("Kod yaz!");
    fetchData(code);
}


/* ==============================================
   SAVE HISTORY (localStorage)
================================================*/
function saveHistory(code){
    let h = JSON.parse(localStorage.getItem("xscan_history") || "[]");
    h.unshift({code:code, time:new Date().toLocaleString()});
    localStorage.setItem("xscan_history", JSON.stringify(h));
    loadHistory();
}

function loadHistory(){
    let h = JSON.parse(localStorage.getItem("xscan_history") || "[]");
    historyList.innerHTML = h.map(item => `
        <div class="glass" style="margin-bottom:10px">
            <b>${item.code}</b><br>
            <small>${item.time}</small>
        </div>
    `).join("");
}
loadHistory();


/* ======================================================
   FETCH DATA (VIN + BARKOD + QR)
=======================================================*/
function fetchData(code){
    goPage("resultPage");
    resultBox.innerHTML = "<h2>Axtarılır...</h2>";

    if(code.length === 17 && /^[A-HJ-NPR-Z0-9]+$/.test(code)){
        fetchVIN(code);
    } else {
        fetchProduct(code);
    }
}


/* ==============================================
   VIN API
================================================*/
function fetchVIN(vin){
    fetch(`https://vpic.nhtsa.dot.gov/api/vehicles/decodevinvalues/${vin}?format=json`)
    .then(r => r.json())
    .then(data => {
        let v = data.Results[0];
        resultBox.innerHTML = `
            <h2>Avtomobil Məlumatı</h2>
            <b>Marka:</b> ${v.Make}<br>
            <b>Model:</b> ${v.Model}<br>
            <b>İl:</b> ${v.ModelYear}<br>
            <b>Tip:</b> ${v.VehicleType}<br>
        `;
    });
}


/* ==============================================
   PRODUCT API
================================================*/
function fetchProduct(code){
    fetch(`https://world.openfoodfacts.org/api/v2/product/${code}.json`)
    .then(r => r.json())

    .then(data => {
        if(!data.product){
            resultBox.innerHTML = `<h2>Məlumat tapılmadı</h2>`;
            return;
        }

        let p = data.product;

        resultBox.innerHTML = `
            <h2>${p.product_name || "Məhsul"}</h2>
            <img class="productImg" src="${p.image_front_url || ""}">
            <br><br>

            <b>Marka:</b> ${p.brands}<br>
            <b>Kategoriya:</b> ${p.categories}<br>
            <b>Təsvir:</b> ${p.generic_name}<br>
        `;
    });
}

</script>

</body>
</html>
