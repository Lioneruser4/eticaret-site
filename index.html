<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Universal Barkod / QR Scanner</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body {
    margin:0;
    font-family:Arial, sans-serif;
    background:#0e1013;
    color:white;
    text-align:center;
}

header {
    background:#181b20;
    padding:20px;
    font-size:24px;
    font-weight:bold;
    letter-spacing:1px;
    box-shadow:0 2px 8px rgba(0,0,0,0.5);
}

#intro {
    margin:20px auto;
    width:90%;
    max-width:450px;
    background:#181b20;
    padding:20px;
    border-radius:12px;
    text-align:left;
    line-height:1.6;
}

button {
    background:#09f;
    border:none;
    padding:15px 20px;
    color:white;
    border-radius:10px;
    font-size:18px;
    margin-top:15px;
    cursor:pointer;
    width:90%;
    max-width:300px;
}

button:hover {
    background:#0bf;
}

#reader {
    margin-top:25px;
    display:none;
}

#loading {
    display:none;
    margin-top:20px;
}

.loader {
  border: 6px solid #444;
  border-top: 6px solid #09f;
  border-radius: 50%;
  width: 45px;
  height: 45px;
  animation: spin 1s linear infinite;
  margin: auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#result {
    background:#181b20;
    margin:20px auto;
    padding:15px;
    border-radius:12px;
    width:90%;
    max-width:450px;
    text-align:left;
    display:none;
}

h3 {
    border-left:4px solid #09f;
    padding-left:10px;
}
</style>
</head>

<body>

<header>ğŸ“¦ Universal Barkod Scanner</header>

<!-- â­ GiriÅŸ mÉ™lumatÄ± -->
<div id="intro">
    <h2>ğŸ” Bu sayt nÉ™ edir?</h2>
    <p>
        Bu platforma barkod vÉ™ QR kodlarÄ±nÄ± oxuyaraq mÉ™hsul haqqÄ±nda mÉ™lumatlarÄ±
        qlobal bazalardan toplayÄ±r:
    </p>
    <ul>
        <li>ğŸ Qida mÉ™hsullarÄ±nÄ±n mÉ™lumatÄ±</li>
        <li>ğŸ’„ ParfÃ¼m & kosmetika mÉ™lumatÄ±</li>
        <li>ğŸ“± Elektronika mÉ™lumatÄ±</li>
        <li>ğŸ“¦ Ãœmumi mÉ™hsul mÉ™lumatÄ±</li>
        <li>ğŸ§ª Batch code â†’ istehsal + bitmÉ™ tarixi</li>
    </ul>
    <p>
        BaÅŸlamaq Ã¼Ã§Ã¼n aÅŸaÄŸÄ±dakÄ± dÃ¼ymÉ™yÉ™ kliklÉ™ vÉ™ kameraya icazÉ™ ver.
    </p>
</div>

<button onclick="startScanner()">ğŸ“· KameranÄ± AÃ§</button>

<!-- â­ Scanner -->
<div id="reader"></div>

<!-- â­ Loading -->
<div id="loading">
  <div class="loader"></div>
  <p>MÉ™lumat yÃ¼klÉ™nir...</p>
</div>

<!-- â­ Result -->
<div id="result"></div>

<script>

let scanner;

function analyzeBatchCode(batch) {
    if (!batch) return null;

    let year, month;

    if (batch.length === 4) {
        year = 2020 + parseInt(batch[0]);
        month = parseInt(batch[1] + batch[2]);
    } else if (batch.length === 5) {
        year = 2015 + parseInt(batch[0]);
        month = parseInt(batch[1] + batch[2]);
    }

    if (!month || month > 12) return null;

    const production = new Date(year, month - 1, 1);
    const expiry = new Date(year + 3, month - 1, 1);

    return {
        production: production.toDateString(),
        expiry: expiry.toDateString()
    };
}

// â­ KameranÄ± aÃ§an funksiya
function startScanner() {
    document.getElementById("intro").style.display = "none";
    document.getElementById("result").style.display = "block";
    document.getElementById("reader").style.display = "block";

    scanner = new Html5Qrcode("reader");

    scanner.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 280 },
        code => {
            searchProduct(code);
        }
    );
}

// â­ MÉ™lumat axtaran funksiya
async function searchProduct(code) {
    document.getElementById("loading").style.display = "block";
    let out = `<b>Barkod:</b> ${code}<br><br>`;

    let found = false;

    // 1ï¸âƒ£ Qida
    try {
        let r = await fetch(`https://world.openfoodfacts.org/api/v0/product/${code}.json`);
        let d = await r.json();

        if (d.status === 1) {
            out += `
            <h3>ğŸ Qida MÉ™hsulu</h3>
            Ad: ${d.product.product_name}<br>
            Marka: ${d.product.brands}<br>
            Kategoriya: ${d.product.categories}<br>
            Ã–lkÉ™: ${d.product.countries}<br><br>
            `;
            found = true;
        }
    } catch {}

    // 2ï¸âƒ£ Kosmetika / parfÃ¼m
    try {
        let r = await fetch(`https://world.openbeautyfacts.org/api/v0/product/${code}.json`);
        let d = await r.json();

        if (d.status === 1) {
            out += `
            <h3>ğŸ’„ ParfÃ¼m / Kosmetika</h3>
            Ad: ${d.product.product_name}<br>
            Marka: ${d.product.brands}<br>
            TÉ™rkib: ${d.product.ingredients_text}<br>
            `;

            // Batch code
            if (d.product.emb_codes) {
                const batch = d.product.emb_codes.split(",")[0].trim();
                const info = analyzeBatchCode(batch);

                if (info) {
                    out += `
                    <br><b>Batch code:</b> ${batch}<br>
                    Ä°stehsal: ${info.production}<br>
                    BitmÉ™ tarixi: ${info.expiry}<br>
                    `;
                }
            }
            out += "<br>";
            found = true;
        }
    } catch {}

    // 3ï¸âƒ£ Elektronika
    try {
        let r = await fetch(`https://api.upcitemdb.com/prod/trial/lookup?upc=${code}`);
        let d = await r.json();

        if (d.items && d.items.length) {
            let p = d.items[0];
            out += `
            <h3>ğŸ“± Elektronika</h3>
            Ad: ${p.title}<br>
            Marka: ${p.brand}<br>
            Kateqoriya: ${p.category}<br><br>
            `;
            found = true;
        }
    } catch {}

    // 4ï¸âƒ£ Ãœmumi mÉ™hsul
    try {
        let r = await fetch(`https://api.upcdatabase.org/product/${code}`);
        let d = await r.json();

        if (d && d.title) {
            out += `
            <h3>ğŸ“¦ MÉ™hsul MÉ™lumatÄ±</h3>
            Ad: ${d.title}<br>
            ÅirkÉ™t: ${d.manufacturer}<br><br>
            `;
            found = true;
        }
    } catch {}

    if (!found) {
        out = "âŒ Bu barkod Ã¼Ã§Ã¼n heÃ§ bir mÉ™lumat tapÄ±lmadÄ±.";
    }

    document.getElementById("loading").style.display = "none";
    document.getElementById("result").innerHTML = out;
}

</script>
</body>
</html>
