<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mələk AI - Xaliq Mustafayev</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #0a0a0b; --accent: #00f2ff; --text: #e0e0e0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        header { padding: 15px; text-align: center; background: #111; border-bottom: 1px solid #222; font-weight: bold; color: var(--accent); text-transform: uppercase; letter-spacing: 2px; }
        #chat-box { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; scroll-behavior: smooth; }
        .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; line-height: 1.5; font-size: 15px; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .ai { align-self: flex-start; background: #18181b; border: 1px solid #27272a; }
        .user { align-self: flex-end; background: var(--accent); color: #000; font-weight: 500; }
        .input-area { padding: 15px; background: #111; display: flex; align-items: center; gap: 10px; border-top: 1px solid #222; }
        input { flex: 1; padding: 12px 20px; border-radius: 25px; border: 1px solid #333; background: #000; color: white; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--accent); }
        .btns { display: flex; gap: 10px; }
        button { border: none; background: none; color: var(--accent); font-size: 22px; cursor: pointer; }
        #mic-btn.active { color: #ff3333; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<header>Mələk AI</header>

<div id="chat-box">
    <div class="msg ai">Salam! Mən Mələk. Xaliq Mustafayev tərəfindən yaradılmışam. Necə kömək edə bilərəm?</div>
</div>

<div class="input-area">
    <input type="text" id="user-input" placeholder="Mələyə sual verin..." autocomplete="off">
    <div class="btns">
        <button id="send-btn"><i class="fas fa-paper-plane"></i></button>
        <button id="mic-btn"><i class="fas fa-microphone"></i></button>
    </div>
</div>

<script>
    const chatBox = document.getElementById('chat-box');
    const userInput = document.getElementById('user-input');
    const sendBtn = document.getElementById('send-btn');
    const micBtn = document.getElementById('mic-btn');

    let isVoiceMode = false;

    // SƏS TANIMA
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = (SpeechRecognition) ? new SpeechRecognition() : null;
    if(recognition) {
        recognition.lang = 'az-AZ';
        recognition.onresult = (e) => {
            isVoiceMode = true;
            processRequest(e.results[0][0].transcript);
        };
        recognition.onend = () => micBtn.classList.remove('active');
    }

    // SƏS SİNTEZİ (Daha aydın)
    function speak(text) {
        window.speechSynthesis.cancel();
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'az-AZ'; 
        utterance.rate = 0.95;
        window.speechSynthesis.speak(utterance);
    }

    function addMsg(text, type) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.innerText = text;
        chatBox.appendChild(div);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    // ƏSAS BEYİN: CHATGPT KİMİ DANIŞMAQ ÜÇÜN (FREE AI PROXY)
    async function processRequest(text) {
        if (!text.trim()) return;
        addMsg(text, 'user');
        userInput.value = '';

        const input = text.toLowerCase();
        let response = "";

        // 1. Xaliq Mustafayev haqqında məlumat (Həmişə sabit)
        if (input.includes("sahib") || input.includes("kim tərəfindən") || input.includes("yaradıcın")) {
            response = "Mənim sahibim və yaradıcım Xaliq Mustafayevdir.";
        }
        else {
            try {
                // Pulsuz və API Key tələb etməyən süni intellekt servisi
                const res = await fetch(`https://text.pollinations.ai/${encodeURIComponent(text)}?system=Sənin adın Mələkdir.Səni Xaliq Mustafayev yaradıb.Həmişə Azərbaycan dilində cavab ver.`);
                response = await res.text();
            } catch (error) {
                response = "Xaliq bəy, sistemdə bir xəta oldu, lakin mən hələ də buradayam.";
            }
        }

        setTimeout(() => {
            addMsg(response, 'ai');
            if (isVoiceMode) {
                speak(response);
                isVoiceMode = false;
            }
        }, 500);
    }

    sendBtn.onclick = () => { isVoiceMode = false; processRequest(userInput.value); };
    userInput.onkeypress = (e) => { if(e.key === 'Enter') { isVoiceMode = false; processRequest(userInput.value); } };
    micBtn.onclick = () => { if(recognition) { recognition.start(); micBtn.classList.add('active'); } };
</script>

</body>
</html>
