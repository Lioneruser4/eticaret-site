<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RESİM QR - Siyah Yerine Resmin</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&display=swap');
    
    body {
      margin:0; padding:40px 20px; min-height:100vh;
      background: linear-gradient(135deg, #667eea, #764ba2);
      font-family:'Poppins',sans-serif;
      color:white;
      display:flex; align-items:center; justify-content:center;
    }
    .card {
      background:rgba(255,255,255,0.1);
      backdrop-filter:blur(15px);
      border-radius:30px;
      padding:40px;
      width:100%; max-width:500px;
      box-shadow:0 20px 60px rgba(0,0,0,0.4);
      text-align:center;
    }
    h1 { font-size:2.8rem; margin:0 0 10px; background:linear-gradient(90deg,#fff,#00ffea); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    input, button { width:100%; padding:18px; margin:15px 0; border:none; border-radius:18px; font-size:1.1rem; }
    input { background:rgba(255,255,255,0.2); color:white; }
    input::placeholder { color:#ddd; }
    .upload {
      border:3px dashed rgba(255,255,255,0.4);
      padding:50px 20px;
      border-radius:20px;
      cursor:pointer;
      transition:0.3s;
    }
    .upload:hover { border-color:#00ffea; background:rgba(0,255,234,0.1); }
    #preview { max-width:150px; margin:20px auto; display:none; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.5); }
    button {
      background:linear-gradient(135deg,#00ffea,#ff00a0);
      color:black; font-weight:800; cursor:pointer;
      box-shadow:0 10px 30px rgba(0,255,234,0.4);
      transition:0.4s;
    }
    button:hover { transform:translateY(-5px); box-shadow:0 20px 40px rgba(0,255,234,0.6); }
    #qr { margin:40px 0; }
    canvas { border-radius:24px; box-shadow:0 20px 50px rgba(0,0,0,0.6); }
    .download { background:#10b981; display:none; }
  </style>
</head>
<body>

<div class="card">
  <h1>RESİM QR</h1>
  <p>Siyah kısımlar senin resmin olacak!</p>

  <input type="text" id="url" placeholder="https://instagram.com/abc" value="https://">

  <div class="upload" onclick="document.getElementById('file').click()">
    <p>RESMİ BURAYA SÜRÜKLE VEYA TIKLA</p>
    <small>En iyi sonuç için 1:1 oranlı, renkli resim kullan</small>
    <img id="preview">
    <input type="file" id="file" accept="image/*" hidden>
  </div>

  <button onclick="olustur()">RESİM QR OLUŞTUR</button>

  <div id="qr"></div>
  <button class="download" onclick="qrCode.download({name:'resim-qr',extension:'png'})">
    İNDİR (PNG)
  </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"></script>
<script>
let qrCode = null;
let resim = null;

document.getElementById('file').onchange = function(e){
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = function(ev){
    resim = ev.target.result;
    document.getElementById('preview').src = resim;
    document.getElementById('preview').style.display = 'block';
  }
  reader.readAsDataURL(file);
}

// Drag & drop desteği
['dragenter','dragover','drop'].forEach(ev => document.querySelector('.upload').addEventListener(ev, e=>e.preventDefault()));
document.querySelector('.upload').addEventListener('drop', e=>{
  const file = e.dataTransfer.files[0];
  if(file && file.type.startsWith('image/')){
    const reader = new FileReader();
    reader.onload = ev=> {
      resim = ev.target.result;
      document.getElementById('preview').src = resim;
      document.getElementById('preview').style.display = 'block';
    }
    reader.readAsDataURL(file);
  }
});

function olustur(){
  const link = document.getElementById('url').value.trim();
  if(!link || !link.startsWith('http')){
    alert('Lütfen geçerli bir link gir (https:// ile başlasın)');
    return;
  }
  if(!resim){
    alert('Önce bir resim yükle!');
    return;
  }

  document.getElementById('qr').innerHTML = '';

  qrCode = new QRCodeStyling({
    width: 600,
    height: 600,
    data: link,
    image: resim,
    dotsOptions: {
      type: "extra-rounded",
      color: "#000000" // bu siyah renk yerine resmin kendisi olacak
    },
    backgroundOptions: { color: "#ffffff" },
    imageOptions: {
      crossOrigin: "anonymous",
      imageSize: 1,           // %100 kaplasın
      margin: 0,
      hideBackgroundDots: false,
      saveAsBlob: true,
      // EN ÖNEMLİ KISIM → Siyah noktalar yerine resmi koy
      dotColorAsImage: true   // ← BU ÖZELLİK TAM İSTEDİĞİN ŞEY!
    },
    qrOptions: { errorCorrectionLevel: "H" }
  });

  qrCode.append(document.getElementById('qr'));
  document.querySelector('.download').style.display = 'block';
}
</script>
</body>
</html>
