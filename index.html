<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpeedPro Mobile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #050505; color: white; font-family: sans-serif; overflow: hidden; }
        /* Neon Efektleri */
        .speed-glow { text-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        .pip-container { display: none; }
        canvas { border-radius: 50%; }
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100; display: flex;
            align-items: center; justify-content: center; text-align: center;
        }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-around py-10">

    <div id="start-overlay">
        <div class="p-6">
            <h1 class="text-2xl font-bold mb-4">SpeedPro Navigasiya</h1>
            <button onclick="startApp()" class="bg-blue-600 px-10 py-4 rounded-full font-bold text-xl shadow-lg shadow-blue-500/50">BA≈ûLAT</button>
            <p class="text-gray-500 mt-4 text-sm">GPS v…ô Video icaz…ôsi t…ôl…ôb olunur.</p>
        </div>
    </div>

    <div class="text-center">
        <div class="text-blue-500 font-bold tracking-widest mb-2 uppercase">S√ºr…ôt</div>
        <div id="speed" class="text-[120px] font-black italic leading-none speed-glow">0</div>
        <div class="text-2xl font-light text-gray-400">KM/H</div>
    </div>

    <div class="w-full px-6 space-y-4">
        <button id="pip-btn" class="w-full bg-white/10 border border-white/20 backdrop-blur-md py-4 rounded-2xl font-semibold flex items-center justify-center gap-2">
            <span>üì∫</span> Ekran √úst√ºnd…ô G√∂st…ôr (PiP)
        </button>
        <div id="status" class="text-center text-xs text-gray-600 uppercase tracking-widest italic">GPS Aktiv deyil</div>
    </div>

    <video id="pip-video" autoplay muted playsinline style="display:none;"></video>
    <canvas id="pip-canvas" width="512" height="512" style="display:none;"></canvas>

    <script>
        const speedEl = document.getElementById('speed');
        const statusEl = document.getElementById('status');
        const videoEl = document.getElementById('pip-video');
        const canvas = document.getElementById('pip-canvas');
        const ctx = canvas.getContext('2d');
        let currentSpeed = 0;

        function startApp() {
            document.getElementById('start-overlay').style.display = 'none';
            initGPS();
        }

        function initGPS() {
            if ("geolocation" in navigator) {
                navigator.geolocation.watchPosition(pos => {
                    const s = pos.coords.speed;
                    currentSpeed = s ? Math.round(s * 3.6) : 0;
                    speedEl.innerText = currentSpeed;
                    statusEl.innerText = "Sistem Hazƒ±rdƒ±r ‚Ä¢ GPS Aktif";
                    statusEl.classList.add('text-green-500');
                    drawToCanvas();
                }, err => {
                    statusEl.innerText = "GPS X…ôtasƒ±: ƒ∞caz…ô verilm…ôyib";
                }, { enableHighAccuracy: true });
            }
        }

        // PiP √º√ß√ºn Canvas √áizimi
        function drawToCanvas() {
            ctx.fillStyle = "#000";
            ctx.fillRect(0, 0, 512, 512);
            
            // Dairevi G√∂sterge
            ctx.strokeStyle = "#3b82f6";
            ctx.lineWidth = 20;
            ctx.beginPath();
            ctx.arc(256, 256, 230, 0, Math.PI * 2);
            ctx.stroke();

            // S√ºr…ôt R…ôq…ômi
            ctx.fillStyle = "#fff";
            ctx.font = "bold 200px Arial";
            ctx.textAlign = "center";
            ctx.fillText(currentSpeed, 256, 310);

            // KM/H Yazƒ±sƒ±
            ctx.font = "40px Arial";
            ctx.fillStyle = "#3b82f6";
            ctx.fillText("KM/H", 256, 380);
        }

        // PiP Aktiv Etme
        document.getElementById('pip-btn').addEventListener('click', async () => {
            try {
                const stream = canvas.captureStream(30);
                videoEl.srcObject = stream;
                await videoEl.play();
                if (document.pictureInPictureEnabled) {
                    await videoEl.requestPictureInPicture();
                }
            } catch (e) {
                alert("Mobil brauzeriniz bu funksiyanƒ± d…ôst…ôkl…ômir.");
            }
        });

        // H…ôr 100ms-d…ô bir yenil…ô (axƒ±cƒ±lƒ±q √º√ß√ºn)
        setInterval(drawToCanvas, 100);
    </script>
</body>
</html>
