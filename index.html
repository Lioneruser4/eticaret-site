<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpeedHUD Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap');
        body { background: #000; color: #fff; font-family: 'Orbitron', sans-serif; margin: 0; overflow: hidden; }
        .speed-text { font-size: 35vw; line-height: 1; filter: drop-shadow(0 0 15px #3b82f6); }
        @media (orientation: landscape) { .speed-text { font-size: 50vh; } }
        canvas { display: none; }
        video { width: 1px; height: 1px; opacity: 0; position: absolute; }
    </style>
</head>
<body class="h-screen flex flex-col items-center justify-center">

    <div id="setup-screen" class="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center p-10 text-center">
        <h1 class="text-xl mb-6 text-blue-500 tracking-widest">Sƒ∞STEMƒ∞ BA≈ûLAT</h1>
        <button onclick="activateSystem()" class="bg-blue-600 px-12 py-5 rounded-2xl font-bold text-xl shadow-[0_0_30px_rgba(59,130,246,0.5)]">GPS V∆è EKRANI AKTƒ∞V ET</button>
        <p class="text-gray-500 mt-6 text-xs uppercase italic">Diqq…ôt: GPS icaz…ôsi √ßƒ±xdƒ±qda "ƒ∞caz…ô ver" se√ßin.</p>
    </div>

    <div class="absolute top-5 left-5 text-[10px] tracking-widest opacity-50">
        GPS: <span id="gps-status" class="text-red-500">K∆èSƒ∞LDƒ∞</span>
    </div>

    <div class="flex flex-col items-center">
        <div id="speed" class="speed-text italic">0</div>
        <div class="text-blue-500 text-xl font-bold tracking-[1rem] uppercase">km/h</div>
    </div>

    <button onclick="togglePiP()" class="absolute bottom-10 bg-white/5 border border-white/10 px-6 py-3 rounded-xl text-xs">
        üñºÔ∏è K√ú√á√úK EKRAN REJƒ∞Mƒ∞
    </button>

    <video id="v" autoplay muted playsinline></video>
    <canvas id="c" width="300" height="300"></canvas>

    <script>
        const speedEl = document.getElementById('speed');
        const gpsStatus = document.getElementById('gps-status');
        const video = document.getElementById('v');
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        let currentSpeed = 0;

        async function activateSystem() {
            document.getElementById('setup-screen').style.display = 'none';
            
            // 1. GPS Ba≈ülat
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(pos => {
                    const s = pos.coords.speed;
                    currentSpeed = s && s > 0 ? Math.round(s * 3.6) : 0;
                    speedEl.innerText = currentSpeed;
                    gpsStatus.innerText = "AKTƒ∞V";
                    gpsStatus.className = "text-green-500";
                    updateCanvas();
                }, (err) => {
                    alert("GPS X…ôtasƒ±: Ayarlardan brauzer…ô yerl…ô≈üm…ô icaz…ôsi verin.");
                }, { enableHighAccuracy: true });
            }

            // 2. Wake Lock (Ekran s√∂nm…ôsin)
            if ('wakeLock' in navigator) {
                try { await navigator.wakeLock.request('screen'); } catch (e) {}
            }
        }

        // PiP √º√ß√ºn Canvas-a S√ºr…ôti Yaz
        function updateCanvas() {
            ctx.fillStyle = "#000";
            ctx.fillRect(0, 0, 300, 300);
            ctx.fillStyle = "#3b82f6";
            ctx.font = "bold 150px Arial";
            ctx.textAlign = "center";
            ctx.fillText(currentSpeed, 150, 180);
            ctx.font = "bold 30px Arial";
            ctx.fillText("KM/H", 150, 240);
        }

        async function togglePiP() {
            try {
                const stream = canvas.captureStream();
                video.srcObject = stream;
                await video.play();
                if (video.requestPictureInPicture) {
                    await video.requestPictureInPicture();
                } else {
                    alert("Brauzeriniz bu funksiyanƒ± d…ôst…ôkl…ômir.");
                }
            } catch (e) {
                console.error(e);
            }
        }

        setInterval(updateCanvas, 200);
    </script>
</body>
</html>
